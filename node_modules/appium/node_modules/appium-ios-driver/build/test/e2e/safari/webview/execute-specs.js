/* globals expect */
'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _desired = require('./desired');

var _desired2 = _interopRequireDefault(_desired);

var _setupBase = require('../../setup-base');

var _setupBase2 = _interopRequireDefault(_setupBase);

var _helpersWebview = require('../../helpers/webview');

var _helpersSession = require('../../helpers/session');

var SCROLL_INTO_VIEW = 'return arguments[0].scrollIntoView(true);';
var GET_RIGHT_INNERHTML = 'return document.body.innerHTML.indexOf(\'I am some page content\') > 0';
var GET_WRONG_INNERHTML = 'return document.body.innerHTML.indexOf(\'I am not some page content\') > 0';
var GET_ELEM_BY_TAGNAME = 'return document.getElementsByTagName(\'a\');';

describe('safari - webview - execute', function () {
  var _this = this;

  this.timeout(_helpersSession.MOCHA_SAFARI_TIMEOUT);

  var driver = (0, _setupBase2['default'])(this, _desired2['default'], { noReset: true }, false, true).driver;
  before(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _helpersWebview.loadWebView)(_desired2['default'], driver));

        case 2:
          return context$2$0.abrupt('return', context$2$0.sent);

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  describe('synchronous', function () {
    var _this2 = this;

    it('should bubble up javascript errors', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute('\'nan\'--').should.eventually.be.rejected);

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should eval javascript', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute('return 1'));

          case 2:
            context$3$0.sent.should.be.equal(1);

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should not be returning hardcoded results', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute('return 1+1'));

          case 2:
            context$3$0.sent.should.be.equal(2);

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should return nothing when you don\'t explicitly return', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute('1+1'));

          case 2:
            context$3$0.t0 = context$3$0.sent;
            expect(context$3$0.t0).to.not.exist;

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should execute code inside the web view', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute(GET_RIGHT_INNERHTML));

          case 2:
            context$3$0.sent.should.be.ok;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.execute(GET_WRONG_INNERHTML));

          case 5:
            context$3$0.sent.should.not.be.ok;

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should convert selenium element arg to webview element', function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('id', 'useragent'));

          case 2:
            el = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.execute(SCROLL_INTO_VIEW, [el]));

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should catch stale or undefined element as arg', function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('id', 'useragent'));

          case 2:
            el = context$3$0.sent;
            return context$3$0.abrupt('return', driver.execute(SCROLL_INTO_VIEW, [{ 'ELEMENT': el.value + 1 }]).should.beRejected);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should be able to return multiple elements from javascript', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute(GET_ELEM_BY_TAGNAME));

          case 2:
            res = context$3$0.sent;

            expect(res).to.have.length.above(0);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
    it('should pass along non-element arguments', function callee$2$0() {
      var arg;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            arg = 'non-element-argument';
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.execute('var args = Array.prototype.slice.call(arguments, 0); return args[0];', [arg]));

          case 3:
            context$3$0.t0 = arg;
            context$3$0.sent.should.be.equal(context$3$0.t0);

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
    it('should handle return values correctly', function callee$2$0() {
      var arg;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            arg = ['one', 'two', 'three'];
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.execute('var args = Array.prototype.slice.call(arguments, 0); return args;', arg));

          case 3:
            context$3$0.t0 = arg;
            context$3$0.sent.should.eql(context$3$0.t0);

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
  });

  describe('asynchronous', function () {
    var _this3 = this;

    it('should bubble up javascript errors', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute('\'nan\'--').should.eventually.be.rejected);

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this3);
    });

    it('should execute async javascript', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.asyncScriptTimeout(1000));

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.executeAsync('arguments[arguments.length - 1](123);'));

          case 4:
            context$3$0.sent.should.be.equal(123);

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this3);
    });

    it('should timeout when callback is not invoked', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.asyncScriptTimeout(1000));

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.executeAsync('return 1 + 2').should.eventually.be.rejected);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this3);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL3NhZmFyaS93ZWJ2aWV3L2V4ZWN1dGUtc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozt1QkFDb0IsV0FBVzs7Ozt5QkFDYixrQkFBa0I7Ozs7OEJBQ1IsdUJBQXVCOzs4QkFDZCx1QkFBdUI7O0FBRzVELElBQU0sZ0JBQWdCLDhDQUE4QyxDQUFDO0FBQ3JFLElBQU0sbUJBQW1CLDJFQUF5RSxDQUFDO0FBQ25HLElBQU0sbUJBQW1CLCtFQUE2RSxDQUFDO0FBQ3ZHLElBQU0sbUJBQW1CLGlEQUErQyxDQUFDOztBQUV6RSxRQUFRLENBQUMsNEJBQTRCLEVBQUUsWUFBWTs7O0FBQ2pELE1BQUksQ0FBQyxPQUFPLHNDQUFzQixDQUFDOztBQUVuQyxNQUFNLE1BQU0sR0FBRyw0QkFBTSxJQUFJLHdCQUFXLEVBQUMsT0FBTyxFQUFFLElBQUksRUFBQyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUM7QUFDekUsUUFBTSxDQUFDOzs7OzsyQ0FBa0IsdURBQXFCLE1BQU0sQ0FBQzs7Ozs7Ozs7OztHQUFBLENBQUMsQ0FBQzs7QUFFdkQsVUFBUSxDQUFDLGFBQWEsRUFBRSxZQUFZOzs7QUFDbEMsTUFBRSxDQUFDLG9DQUFvQyxFQUFFOzs7Ozs2Q0FDakMsTUFBTSxDQUFDLE9BQU8sYUFBVyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLFFBQVE7Ozs7Ozs7S0FDOUQsQ0FBQyxDQUFDOztBQUVILE1BQUUsQ0FBQyx3QkFBd0IsRUFBRTs7Ozs7NkNBQ3BCLE1BQU0sQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDOzs7NkJBQUUsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQzs7Ozs7OztLQUNyRCxDQUFDLENBQUM7O0FBRUgsTUFBRSxDQUFDLDJDQUEyQyxFQUFFOzs7Ozs2Q0FDdkMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUM7Ozs2QkFBRSxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDOzs7Ozs7O0tBQ3ZELENBQUMsQ0FBQzs7QUFFSCxNQUFFLDREQUEyRDs7Ozs7NkNBQzlDLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDOzs7O0FBQWxDLGtCQUFNLGlCQUE4QixFQUFFLENBQUMsR0FBRyxDQUFDLEtBQUs7Ozs7Ozs7S0FDakQsQ0FBQyxDQUFDOztBQUVILE1BQUUsQ0FBQyx5Q0FBeUMsRUFBRTs7Ozs7NkNBQ3JDLE1BQU0sQ0FBQyxPQUFPLENBQUMsbUJBQW1CLENBQUM7Ozs2QkFBRSxNQUFNLENBQUMsRUFBRSxDQUFDLEVBQUU7OzZDQUNqRCxNQUFNLENBQUMsT0FBTyxDQUFDLG1CQUFtQixDQUFDOzs7NkJBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRTs7Ozs7OztLQUM3RCxDQUFDLENBQUM7O0FBRUgsTUFBRSxDQUFDLHdEQUF3RCxFQUFFO1VBQ3ZELEVBQUU7Ozs7OzZDQUFTLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLFdBQVcsQ0FBQzs7O0FBQWhELGNBQUU7OzZDQUNBLE1BQU0sQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQzs7Ozs7OztLQUM3QyxDQUFDLENBQUM7O0FBRUgsTUFBRSxDQUFDLGdEQUFnRCxFQUFFO1VBQy9DLEVBQUU7Ozs7OzZDQUFTLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLFdBQVcsQ0FBQzs7O0FBQWhELGNBQUU7Z0RBQ0MsTUFBTSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLEVBQUMsU0FBUyxFQUFHLEVBQUUsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxBQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVU7Ozs7Ozs7S0FDekYsQ0FBQyxDQUFDOztBQUVILE1BQUUsQ0FBQyw0REFBNEQsRUFBRTtVQUMzRCxHQUFHOzs7Ozs2Q0FBUyxNQUFNLENBQUMsT0FBTyxDQUFDLG1CQUFtQixDQUFDOzs7QUFBL0MsZUFBRzs7QUFDUCxrQkFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQzs7Ozs7OztLQUNyQyxDQUFDLENBQUM7QUFDSCxNQUFFLENBQUMseUNBQXlDLEVBQUU7VUFDeEMsR0FBRzs7OztBQUFILGVBQUcsR0FBRyxzQkFBc0I7OzZDQUN6QixNQUFNLENBQUMsT0FBTyxDQUFDLHNFQUFzRSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUM7Ozs2QkFBa0IsR0FBRzs2QkFBbkIsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLOzs7Ozs7O0tBQ3RILENBQUMsQ0FBQztBQUNILE1BQUUsQ0FBQyx1Q0FBdUMsRUFBRTtVQUN0QyxHQUFHOzs7O0FBQUgsZUFBRyxHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUM7OzZDQUMxQixNQUFNLENBQUMsT0FBTyxDQUFDLG1FQUFtRSxFQUFFLEdBQUcsQ0FBQzs7OzZCQUFhLEdBQUc7NkJBQWQsTUFBTSxDQUFDLEdBQUc7Ozs7Ozs7S0FDNUcsQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDOztBQUVILFVBQVEsQ0FBQyxjQUFjLEVBQUUsWUFBWTs7O0FBQ25DLE1BQUUsQ0FBQyxvQ0FBb0MsRUFBRTs7Ozs7NkNBQ2pDLE1BQU0sQ0FBQyxPQUFPLGFBQVcsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxRQUFROzs7Ozs7O0tBQzlELENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMsaUNBQWlDLEVBQUU7Ozs7OzZDQUM5QixNQUFNLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDOzs7OzZDQUM5QixNQUFNLENBQUMsWUFBWSx5Q0FBeUM7Ozs2QkFBRSxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHOzs7Ozs7O0tBQ3pGLENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMsNkNBQTZDLEVBQUU7Ozs7OzZDQUMxQyxNQUFNLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDOzs7OzZDQUMvQixNQUFNLENBQUMsWUFBWSxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxRQUFROzs7Ozs7O0tBQ3hFLENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L2UyZS9zYWZhcmkvd2Vidmlldy9leGVjdXRlLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFscyBleHBlY3QgKi9cbmltcG9ydCBkZXNpcmVkIGZyb20gJy4vZGVzaXJlZCc7XG5pbXBvcnQgc2V0dXAgZnJvbSAnLi4vLi4vc2V0dXAtYmFzZSc7XG5pbXBvcnQgeyBsb2FkV2ViVmlldyB9IGZyb20gJy4uLy4uL2hlbHBlcnMvd2Vidmlldyc7XG5pbXBvcnQgeyBNT0NIQV9TQUZBUklfVElNRU9VVCB9IGZyb20gJy4uLy4uL2hlbHBlcnMvc2Vzc2lvbic7XG5cblxuY29uc3QgU0NST0xMX0lOVE9fVklFVyA9IGByZXR1cm4gYXJndW1lbnRzWzBdLnNjcm9sbEludG9WaWV3KHRydWUpO2A7XG5jb25zdCBHRVRfUklHSFRfSU5ORVJIVE1MID0gYHJldHVybiBkb2N1bWVudC5ib2R5LmlubmVySFRNTC5pbmRleE9mKCdJIGFtIHNvbWUgcGFnZSBjb250ZW50JykgPiAwYDtcbmNvbnN0IEdFVF9XUk9OR19JTk5FUkhUTUwgPSBgcmV0dXJuIGRvY3VtZW50LmJvZHkuaW5uZXJIVE1MLmluZGV4T2YoJ0kgYW0gbm90IHNvbWUgcGFnZSBjb250ZW50JykgPiAwYDtcbmNvbnN0IEdFVF9FTEVNX0JZX1RBR05BTUUgPSBgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdhJyk7YDtcblxuZGVzY3JpYmUoJ3NhZmFyaSAtIHdlYnZpZXcgLSBleGVjdXRlJywgZnVuY3Rpb24gKCkge1xuICB0aGlzLnRpbWVvdXQoTU9DSEFfU0FGQVJJX1RJTUVPVVQpO1xuXG4gIGNvbnN0IGRyaXZlciA9IHNldHVwKHRoaXMsIGRlc2lyZWQsIHtub1Jlc2V0OiB0cnVlfSwgZmFsc2UsIHRydWUpLmRyaXZlcjtcbiAgYmVmb3JlKGFzeW5jICgpID0+IGF3YWl0IGxvYWRXZWJWaWV3KGRlc2lyZWQsIGRyaXZlcikpO1xuXG4gIGRlc2NyaWJlKCdzeW5jaHJvbm91cycsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIGJ1YmJsZSB1cCBqYXZhc2NyaXB0IGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGRyaXZlci5leGVjdXRlKGAnbmFuJy0tYCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWQ7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGV2YWwgamF2YXNjcmlwdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIChhd2FpdCBkcml2ZXIuZXhlY3V0ZSgncmV0dXJuIDEnKSkuc2hvdWxkLmJlLmVxdWFsKDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgYmUgcmV0dXJuaW5nIGhhcmRjb2RlZCByZXN1bHRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKGF3YWl0IGRyaXZlci5leGVjdXRlKCdyZXR1cm4gMSsxJykpLnNob3VsZC5iZS5lcXVhbCgyKTtcbiAgICB9KTtcblxuICAgIGl0KGBzaG91bGQgcmV0dXJuIG5vdGhpbmcgd2hlbiB5b3UgZG9uJ3QgZXhwbGljaXRseSByZXR1cm5gLCBhc3luYyAoKSA9PiB7XG4gICAgICBleHBlY3QoYXdhaXQgZHJpdmVyLmV4ZWN1dGUoJzErMScpKS50by5ub3QuZXhpc3Q7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGV4ZWN1dGUgY29kZSBpbnNpZGUgdGhlIHdlYiB2aWV3JywgYXN5bmMgKCkgPT4ge1xuICAgICAgKGF3YWl0IGRyaXZlci5leGVjdXRlKEdFVF9SSUdIVF9JTk5FUkhUTUwpKS5zaG91bGQuYmUub2s7XG4gICAgICAoYXdhaXQgZHJpdmVyLmV4ZWN1dGUoR0VUX1dST05HX0lOTkVSSFRNTCkpLnNob3VsZC5ub3QuYmUub2s7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNvbnZlcnQgc2VsZW5pdW0gZWxlbWVudCBhcmcgdG8gd2VidmlldyBlbGVtZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50KCdpZCcsICd1c2VyYWdlbnQnKTtcbiAgICAgIGF3YWl0IGRyaXZlci5leGVjdXRlKFNDUk9MTF9JTlRPX1ZJRVcsIFtlbF0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYXRjaCBzdGFsZSBvciB1bmRlZmluZWQgZWxlbWVudCBhcyBhcmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnQoJ2lkJywgJ3VzZXJhZ2VudCcpO1xuICAgICAgcmV0dXJuIGRyaXZlci5leGVjdXRlKFNDUk9MTF9JTlRPX1ZJRVcsIFt7J0VMRU1FTlQnOiAoZWwudmFsdWUgKyAxKX1dKS5zaG91bGQuYmVSZWplY3RlZDtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYmUgYWJsZSB0byByZXR1cm4gbXVsdGlwbGUgZWxlbWVudHMgZnJvbSBqYXZhc2NyaXB0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHJlcyA9IGF3YWl0IGRyaXZlci5leGVjdXRlKEdFVF9FTEVNX0JZX1RBR05BTUUpO1xuICAgICAgZXhwZWN0KHJlcykudG8uaGF2ZS5sZW5ndGguYWJvdmUoMCk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBwYXNzIGFsb25nIG5vbi1lbGVtZW50IGFyZ3VtZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBhcmcgPSAnbm9uLWVsZW1lbnQtYXJndW1lbnQnO1xuICAgICAgKGF3YWl0IGRyaXZlci5leGVjdXRlKCd2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCk7IHJldHVybiBhcmdzWzBdOycsIFthcmddKSkuc2hvdWxkLmJlLmVxdWFsKGFyZyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcmV0dXJuIHZhbHVlcyBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgYXJnID0gWydvbmUnLCAndHdvJywgJ3RocmVlJ107XG4gICAgICAoYXdhaXQgZHJpdmVyLmV4ZWN1dGUoJ3ZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsgcmV0dXJuIGFyZ3M7JywgYXJnKSkuc2hvdWxkLmVxbChhcmcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnYXN5bmNocm9ub3VzJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgYnViYmxlIHVwIGphdmFzY3JpcHQgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZHJpdmVyLmV4ZWN1dGUoYCduYW4nLS1gKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZDtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXhlY3V0ZSBhc3luYyBqYXZhc2NyaXB0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZHJpdmVyLmFzeW5jU2NyaXB0VGltZW91dCgxMDAwKTtcbiAgICAgIChhd2FpdCBkcml2ZXIuZXhlY3V0ZUFzeW5jKGBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdKDEyMyk7YCkpLnNob3VsZC5iZS5lcXVhbCgxMjMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aW1lb3V0IHdoZW4gY2FsbGJhY2sgaXMgbm90IGludm9rZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBkcml2ZXIuYXN5bmNTY3JpcHRUaW1lb3V0KDEwMDApO1xuICAgICAgYXdhaXQgZHJpdmVyLmV4ZWN1dGVBc3luYyhgcmV0dXJuIDEgKyAyYCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWQ7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uLy4uLy4uIn0=
