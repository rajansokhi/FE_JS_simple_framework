'use strict';

var _createClass = require('babel-runtime/helpers/create-class')['default'];

var _classCallCheck = require('babel-runtime/helpers/class-call-check')['default'];

var _getIterator = require('babel-runtime/core-js/get-iterator')['default'];

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _teen_process = require('teen_process');

var _appiumBaseDriver = require('appium-base-driver');

var _asyncbox = require('asyncbox');

var _logger = require('./logger');

var _logger2 = _interopRequireDefault(_logger);

var _installer = require('./installer');

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var REQD_PARAMS = ['adb', 'tmpDir', 'host', 'systemPort', 'devicePort'];

var adbkit = require('adbkit');
var client = adbkit.createClient();

var UiAutomator2Server = (function () {
  function UiAutomator2Server() {
    var opts = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

    _classCallCheck(this, UiAutomator2Server);

    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = _getIterator(REQD_PARAMS), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        var req = _step.value;

        if (!opts || !opts[req]) {
          throw new Error('Option \'' + req + '\' is required!');
        }
        this[req] = opts[req];
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator['return']) {
          _iterator['return']();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }

    this.jwproxy = new _appiumBaseDriver.JWProxy({ host: this.host, port: this.systemPort });
    this.proxyReqRes = this.jwproxy.proxyReqRes.bind(this.jwproxy);
  }

  _createClass(UiAutomator2Server, [{
    key: 'installServerApk',
    value: function installServerApk() {
      var apkPackage, testApkPackage, isApkInstalled, isTestApkInstalled, apkVersion, pkgVersion;
      return _regeneratorRuntime.async(function installServerApk$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            context$2$0.next = 2;
            return _regeneratorRuntime.awrap(this.getPackageName(_installer.UI2_SERVER_APK_PATH));

          case 2:
            apkPackage = context$2$0.sent;
            testApkPackage = apkPackage + '.test';
            context$2$0.next = 6;
            return _regeneratorRuntime.awrap(this.adb.isAppInstalled(apkPackage));

          case 6:
            isApkInstalled = context$2$0.sent;
            context$2$0.next = 9;
            return _regeneratorRuntime.awrap(this.adb.isAppInstalled(testApkPackage));

          case 9:
            isTestApkInstalled = context$2$0.sent;

            if (!(isApkInstalled || isTestApkInstalled)) {
              context$2$0.next = 24;
              break;
            }

            context$2$0.next = 13;
            return _regeneratorRuntime.awrap(this.getAPKVersion(_installer.UI2_SERVER_APK_PATH));

          case 13:
            apkVersion = context$2$0.sent;
            context$2$0.next = 16;
            return _regeneratorRuntime.awrap(this.getInstalledPackageVersion(apkPackage));

          case 16:
            pkgVersion = context$2$0.sent;

            if (!(apkVersion !== pkgVersion)) {
              context$2$0.next = 24;
              break;
            }

            isApkInstalled = false;
            isTestApkInstalled = false;
            context$2$0.next = 22;
            return _regeneratorRuntime.awrap(this.adb.uninstallApk(apkPackage));

          case 22:
            context$2$0.next = 24;
            return _regeneratorRuntime.awrap(this.adb.uninstallApk(testApkPackage));

          case 24:
            if (isApkInstalled) {
              context$2$0.next = 27;
              break;
            }

            context$2$0.next = 27;
            return _regeneratorRuntime.awrap(this.signAndInstall(_installer.UI2_SERVER_APK_PATH, apkPackage));

          case 27:
            if (isTestApkInstalled) {
              context$2$0.next = 30;
              break;
            }

            context$2$0.next = 30;
            return _regeneratorRuntime.awrap(this.signAndInstall(_installer.UI2_TEST_APK_PATH, testApkPackage));

          case 30:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'signAndInstall',
    value: function signAndInstall(apk, apkPackage) {
      return _regeneratorRuntime.async(function signAndInstall$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            context$2$0.next = 2;
            return _regeneratorRuntime.awrap(this.checkAndSignCert(apk, apkPackage));

          case 2:
            context$2$0.next = 4;
            return _regeneratorRuntime.awrap(this.adb.install(apk));

          case 4:
            _logger2['default'].info("Installed UiAutomator2 server apk");

          case 5:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'getPackageName',
    value: function getPackageName(apk) {
      var args, _ref, stdout, apkPackage;

      return _regeneratorRuntime.async(function getPackageName$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            args = ['dump', 'badging', apk];
            context$2$0.next = 3;
            return _regeneratorRuntime.awrap(this.adb.initAapt());

          case 3:
            context$2$0.next = 5;
            return _regeneratorRuntime.awrap((0, _teen_process.exec)(this.adb.binaries.aapt, args));

          case 5:
            _ref = context$2$0.sent;
            stdout = _ref.stdout;
            apkPackage = new RegExp(/package: name='([^']+)'/g).exec(stdout);

            if (apkPackage && apkPackage.length >= 2) {
              apkPackage = apkPackage[1];
            } else {
              apkPackage = null;
            }
            return context$2$0.abrupt('return', apkPackage);

          case 10:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'getAPKVersion',
    value: function getAPKVersion(apk) {
      var args, _ref2, stdout, apkVersion;

      return _regeneratorRuntime.async(function getAPKVersion$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            args = ['dump', 'badging', apk];
            context$2$0.next = 3;
            return _regeneratorRuntime.awrap(this.adb.initAapt());

          case 3:
            context$2$0.next = 5;
            return _regeneratorRuntime.awrap((0, _teen_process.exec)(this.adb.binaries.aapt, args));

          case 5:
            _ref2 = context$2$0.sent;
            stdout = _ref2.stdout;
            apkVersion = new RegExp(/versionName='([^']+)'/g).exec(stdout);

            if (apkVersion && apkVersion.length >= 2) {
              apkVersion = apkVersion[1];
            } else {
              apkVersion = null;
            }
            return context$2$0.abrupt('return', apkVersion.toString());

          case 10:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'getInstalledPackageVersion',
    value: function getInstalledPackageVersion(pkg) {
      var stdout, pkgVersion;
      return _regeneratorRuntime.async(function getInstalledPackageVersion$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            context$2$0.next = 2;
            return _regeneratorRuntime.awrap(this.adb.shell(['dumpsys', 'package', pkg]));

          case 2:
            stdout = context$2$0.sent;
            pkgVersion = new RegExp(/versionName=([^\s\s]+)/g).exec(stdout);

            if (pkgVersion && pkgVersion.length >= 2) {
              pkgVersion = pkgVersion[1];
            } else {
              pkgVersion = null;
            }
            return context$2$0.abrupt('return', pkgVersion.toString());

          case 6:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'checkAndSignCert',
    value: function checkAndSignCert(apk, apkPackage) {
      var signed;
      return _regeneratorRuntime.async(function checkAndSignCert$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            context$2$0.next = 2;
            return _regeneratorRuntime.awrap(this.adb.checkApkCert(apk, apkPackage));

          case 2:
            signed = context$2$0.sent;

            if (signed) {
              context$2$0.next = 6;
              break;
            }

            context$2$0.next = 6;
            return _regeneratorRuntime.awrap(this.adb.sign(apk));

          case 6:
            return context$2$0.abrupt('return', !signed);

          case 7:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'startSession',
    value: function startSession(caps) {
      var cmd;
      return _regeneratorRuntime.async(function startSession$(context$2$0) {
        var _this = this;

        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            cmd = ['am', 'instrument', '-w', 'io.appium.uiautomator2.server.test/android.support.test.runner.AndroidJUnitRunner'];
            context$2$0.next = 3;
            return _regeneratorRuntime.awrap(this.killUiAutomatorOnDevice());

          case 3:

            _logger2['default'].info('Starting uiautomator2 server ' + _installer.UI2_VER + ' with cmd: ' + ('' + cmd));
            //this.adb.shell(cmd);
            //using 3rd party module called 'adbKit' for time being as using 'appium-adb'
            //facing IllegalStateException: UiAutomation not connected exception
            //https://github.com/appium/appium-uiautomator2-driver/issues/19

            if (caps.deviceUDID) {
              this.startSessionOnSpecificDeviceUsingAdbKit(caps.deviceUDID);
            } else {
              this.startSessionUsingAdbkit();
            }

            _logger2['default'].info('Waiting for UiAutomator2 to be online...');
            // wait 20s for UiAutomator2 to be online
            context$2$0.next = 8;
            return _regeneratorRuntime.awrap((0, _asyncbox.retryInterval)(20, 1000, function callee$2$0() {
              return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
                while (1) switch (context$3$0.prev = context$3$0.next) {
                  case 0:
                    context$3$0.next = 2;
                    return _regeneratorRuntime.awrap(this.jwproxy.command('/status', 'GET'));

                  case 2:
                  case 'end':
                    return context$3$0.stop();
                }
              }, null, _this);
            }));

          case 8:
            context$2$0.next = 10;
            return _regeneratorRuntime.awrap(this.jwproxy.command('/session', 'POST', { desiredCapabilities: caps }));

          case 10:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'startSessionOnSpecificDeviceUsingAdbKit',
    value: function startSessionOnSpecificDeviceUsingAdbKit(deviceUDID) {
      return _regeneratorRuntime.async(function startSessionOnSpecificDeviceUsingAdbKit$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _bluebird2['default']['try'](function () {
              _logger2['default'].info('running command...\n adb -s ' + deviceUDID + ' shell am instrument -w io.appium.uiautomator2.server.test/android.support.test.runner.AndroidJUnitRunner... ');
              client.shell(deviceUDID, "am instrument -w io.appium.uiautomator2.server.test/android.support.test.runner.AndroidJUnitRunner");
            })['catch'](function (err) {
              _logger2['default'].error('Something went wrong while executing instrument test:', err.stack);
            });

          case 1:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'startSessionUsingAdbkit',
    value: function startSessionUsingAdbkit() {
      return _regeneratorRuntime.async(function startSessionUsingAdbkit$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            client.listDevices().then(function (devices) {
              _bluebird2['default'].map(devices, function (device) {
                _logger2['default'].info("running command...\n adb shell am instrument -w io.appium.uiautomator2.server.test/android.support.test.runner.AndroidJUnitRunner... ");
                client.shell(device.id, "am instrument -w io.appium.uiautomator2.server.test/android.support.test.runner.AndroidJUnitRunner");
              });
            })['catch'](function (err) {
              _logger2['default'].error('Something went wrong while executing instrument test:', err.stack);
            });

          case 1:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'deleteSession',
    value: function deleteSession() {
      return _regeneratorRuntime.async(function deleteSession$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _logger2['default'].debug('Deleting UiAutomator2 server session');
            // rely on jwproxy's intelligence to know what we're talking about and
            // delete the current session
            context$2$0.prev = 1;
            context$2$0.next = 4;
            return _regeneratorRuntime.awrap(this.jwproxy.command('/', 'DELETE'));

          case 4:
            context$2$0.next = 9;
            break;

          case 6:
            context$2$0.prev = 6;
            context$2$0.t0 = context$2$0['catch'](1);

            _logger2['default'].warn('Did not get confirmation UiAutomator2 deleteSession worked; ' + ('Error was: ' + context$2$0.t0));

          case 9:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this, [[1, 6]]);
    }
  }, {
    key: 'killUiAutomatorOnDevice',
    value: function killUiAutomatorOnDevice() {
      return _regeneratorRuntime.async(function killUiAutomatorOnDevice$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            context$2$0.prev = 0;
            context$2$0.next = 3;
            return _regeneratorRuntime.awrap(this.adb.forceStop('io.appium.uiautomator2.server'));

          case 3:
            context$2$0.next = 8;
            break;

          case 5:
            context$2$0.prev = 5;
            context$2$0.t0 = context$2$0['catch'](0);

            _logger2['default'].info("Unable to kill the io.appium.uiautomator2.server process, assuming it is already killed");

          case 8:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this, [[0, 5]]);
    }
  }]);

  return UiAutomator2Server;
})();

exports['default'] = UiAutomator2Server;
module.exports = exports['default'];

// Installs the apks on to the device or emulator

// appending .test to apkPackage name to get test apk package name

//check server apk versionName

// killing any uiautomator existing processes
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi91aWF1dG9tYXRvcjIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs0QkFBcUIsY0FBYzs7Z0NBQ1gsb0JBQW9COzt3QkFDZCxVQUFVOztzQkFDckIsVUFBVTs7Ozt5QkFDNEQsYUFBYTs7d0JBQ2xGLFVBQVU7Ozs7QUFFOUIsSUFBTSxXQUFXLEdBQUcsQ0FBQyxLQUFLLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsWUFBWSxDQUFDLENBQUM7O0FBRTFFLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUMvQixJQUFJLE1BQU0sR0FBRyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUM7O0lBRTdCLGtCQUFrQjtBQUNWLFdBRFIsa0JBQWtCLEdBQ0U7UUFBWCxJQUFJLHlEQUFHLEVBQUU7OzBCQURsQixrQkFBa0I7Ozs7Ozs7QUFFcEIsd0NBQWdCLFdBQVcsNEdBQUU7WUFBcEIsR0FBRzs7QUFDVixZQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFO0FBQ3ZCLGdCQUFNLElBQUksS0FBSyxlQUFZLEdBQUcscUJBQWlCLENBQUM7U0FDakQ7QUFDRCxZQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO09BQ3ZCOzs7Ozs7Ozs7Ozs7Ozs7O0FBQ0QsUUFBSSxDQUFDLE9BQU8sR0FBRyw4QkFBWSxFQUFDLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsVUFBVSxFQUFDLENBQUMsQ0FBQztBQUNyRSxRQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7R0FDaEU7O2VBVkcsa0JBQWtCOztXQVlDO1VBRWpCLFVBQVUsRUFFVixjQUFjLEVBQ2QsY0FBYyxFQUNkLGtCQUFr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Q0FBQyxDQUFDOzs7Ozs2Q0FJN0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQzs7Ozs7Ozs7OztBQUV6QyxnQ0FBTyxJQUFJLENBQUMsaUdBQ1csQ0FBQyxDQUFDOzs7Ozs7O0tBRTVCOzs7V0FFNkI7Ozs7Ozs2Q0FFcEIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsK0JBQStCLENBQUM7Ozs7Ozs7Ozs7QUFFekQsZ0NBQU8sSUFBSSxDQUFDLHlGQUF5RixDQUFDLENBQUM7Ozs7Ozs7S0FFMUc7OztTQTlKRyxrQkFBa0I7OztxQkFpS1Qsa0JBQWtCIiwiZmlsZSI6ImxpYi91aWF1dG9tYXRvcjIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCB7IEpXUHJveHkgfSBmcm9tICdhcHBpdW0tYmFzZS1kcml2ZXInO1xuaW1wb3J0IHsgcmV0cnlJbnRlcnZhbCB9IGZyb20gJ2FzeW5jYm94JztcbmltcG9ydCBsb2dnZXIgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHsgVUkyX1NFUlZFUl9BUEtfUEFUSCBhcyBhcGtQYXRoLCBVSTJfVEVTVF9BUEtfUEFUSCBhcyB0ZXN0QXBrUGF0aCwgVUkyX1ZFUn0gZnJvbSAnLi9pbnN0YWxsZXInO1xuaW1wb3J0IFByb21pc2UgZnJvbSAnYmx1ZWJpcmQnO1xuXG5jb25zdCBSRVFEX1BBUkFNUyA9IFsnYWRiJywgJ3RtcERpcicsICdob3N0JywgJ3N5c3RlbVBvcnQnLCAnZGV2aWNlUG9ydCddO1xuXG52YXIgYWRia2l0ID0gcmVxdWlyZSgnYWRia2l0Jyk7XG52YXIgY2xpZW50ID0gYWRia2l0LmNyZWF0ZUNsaWVudCgpO1xuXG5jbGFzcyBVaUF1dG9tYXRvcjJTZXJ2ZXIge1xuICBjb25zdHJ1Y3RvciAob3B0cyA9IHt9KSB7XG4gICAgZm9yIChsZXQgcmVxIG9mIFJFUURfUEFSQU1TKSB7XG4gICAgICBpZiAoIW9wdHMgfHwgIW9wdHNbcmVxXSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE9wdGlvbiAnJHtyZXF9JyBpcyByZXF1aXJlZCFgKTtcbiAgICAgIH1cbiAgICAgIHRoaXNbcmVxXSA9IG9wdHNbcmVxXTtcbiAgICB9XG4gICAgdGhpcy5qd3Byb3h5ID0gbmV3IEpXUHJveHkoe2hvc3Q6IHRoaXMuaG9zdCwgcG9ydDogdGhpcy5zeXN0ZW1Qb3J0fSk7XG4gICAgdGhpcy5wcm94eVJlcVJlcyA9IHRoaXMuandwcm94eS5wcm94eVJlcVJlcy5iaW5kKHRoaXMuandwcm94eSk7XG4gIH1cblxuICBhc3luYyBpbnN0YWxsU2VydmVyQXBrICgpIHtcbiAgICAvLyBJbnN0YWxscyB0aGUgYXBrcyBvbiB0byB0aGUgZGV2aWNlIG9yIGVtdWxhdG9yXG4gICAgbGV0IGFwa1BhY2thZ2UgPSBhd2FpdCB0aGlzLmdldFBhY2thZ2VOYW1lKGFwa1BhdGgpO1xuICAgIC8vIGFwcGVuZGluZyAudGVzdCB0byBhcGtQYWNrYWdlIG5hbWUgdG8gZ2V0IHRlc3QgYXBrIHBhY2thZ2UgbmFtZVxuICAgIGxldCB0ZXN0QXBrUGFja2FnZSA9IGFwa1BhY2thZ2UgKyAnLnRlc3QnO1xuICAgIGxldCBpc0Fwa0luc3RhbGxlZCA9IGF3YWl0IHRoaXMuYWRiLmlzQXBwSW5zdGFsbGVkKGFwa1BhY2thZ2UpO1xuICAgIGxldCBpc1Rlc3RBcGtJbnN0YWxsZWQgPSBhd2FpdCB0aGlzLmFkYi5pc0FwcEluc3RhbGxlZCh0ZXN0QXBrUGFja2FnZSk7XG4gICAgaWYgKGlzQXBrSW5zdGFsbGVkIHx8IGlzVGVzdEFwa0luc3RhbGxlZCkge1xuICAgICAgLy9jaGVjayBzZXJ2ZXIgYXBrIHZlcnNpb25OYW1lXG4gICAgICBsZXQgYXBrVmVyc2lvbiA9IGF3YWl0IHRoaXMuZ2V0QVBLVmVyc2lvbihhcGtQYXRoKTtcbiAgICAgIGxldCBwa2dWZXJzaW9uID0gYXdhaXQgdGhpcy5nZXRJbnN0YWxsZWRQYWNrYWdlVmVyc2lvbihhcGtQYWNrYWdlKTtcbiAgICAgIGlmIChhcGtWZXJzaW9uICE9PSBwa2dWZXJzaW9uKSB7XG4gICAgICAgIGlzQXBrSW5zdGFsbGVkID0gZmFsc2U7XG4gICAgICAgIGlzVGVzdEFwa0luc3RhbGxlZCA9IGZhbHNlO1xuICAgICAgICBhd2FpdCB0aGlzLmFkYi51bmluc3RhbGxBcGsoYXBrUGFja2FnZSk7XG4gICAgICAgIGF3YWl0IHRoaXMuYWRiLnVuaW5zdGFsbEFwayh0ZXN0QXBrUGFja2FnZSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghaXNBcGtJbnN0YWxsZWQpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2lnbkFuZEluc3RhbGwoYXBrUGF0aCwgYXBrUGFja2FnZSk7XG4gICAgfVxuICAgIGlmICghaXNUZXN0QXBrSW5zdGFsbGVkKSB7XG4gICAgICBhd2FpdCB0aGlzLnNpZ25BbmRJbnN0YWxsKHRlc3RBcGtQYXRoLCB0ZXN0QXBrUGFja2FnZSk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2lnbkFuZEluc3RhbGwgKGFwaywgYXBrUGFja2FnZSkge1xuICAgIGF3YWl0IHRoaXMuY2hlY2tBbmRTaWduQ2VydChhcGssIGFwa1BhY2thZ2UpO1xuICAgIGF3YWl0IHRoaXMuYWRiLmluc3RhbGwoYXBrKTtcbiAgICBsb2dnZXIuaW5mbyhcIkluc3RhbGxlZCBVaUF1dG9tYXRvcjIgc2VydmVyIGFwa1wiKTtcbiAgfVxuXG4gIGFzeW5jIGdldFBhY2thZ2VOYW1lIChhcGspIHtcbiAgICBsZXQgYXJncyA9IFsnZHVtcCcsICdiYWRnaW5nJywgYXBrXTtcbiAgICBhd2FpdCB0aGlzLmFkYi5pbml0QWFwdCgpO1xuICAgIGxldCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWModGhpcy5hZGIuYmluYXJpZXMuYWFwdCwgYXJncyk7XG4gICAgbGV0IGFwa1BhY2thZ2UgPSBuZXcgUmVnRXhwKC9wYWNrYWdlOiBuYW1lPScoW14nXSspJy9nKS5leGVjKHN0ZG91dCk7XG4gICAgaWYgKGFwa1BhY2thZ2UgJiYgYXBrUGFja2FnZS5sZW5ndGggPj0gMikge1xuICAgICAgYXBrUGFja2FnZSA9IGFwa1BhY2thZ2VbMV07XG4gICAgfSBlbHNlIHtcbiAgICAgIGFwa1BhY2thZ2UgPSBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gYXBrUGFja2FnZTtcbiAgfVxuXG4gIGFzeW5jIGdldEFQS1ZlcnNpb24gKGFwaykge1xuICAgIGxldCBhcmdzID0gWydkdW1wJywgJ2JhZGdpbmcnLCBhcGtdO1xuICAgIGF3YWl0IHRoaXMuYWRiLmluaXRBYXB0KCk7XG4gICAgbGV0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYyh0aGlzLmFkYi5iaW5hcmllcy5hYXB0LCBhcmdzKTtcbiAgICBsZXQgYXBrVmVyc2lvbiA9IG5ldyBSZWdFeHAoL3ZlcnNpb25OYW1lPScoW14nXSspJy9nKS5leGVjKHN0ZG91dCk7XG4gICAgaWYgKGFwa1ZlcnNpb24gJiYgYXBrVmVyc2lvbi5sZW5ndGggPj0gMikge1xuICAgICAgYXBrVmVyc2lvbiA9IGFwa1ZlcnNpb25bMV07XG4gICAgfSBlbHNlIHtcbiAgICAgIGFwa1ZlcnNpb24gPSBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gYXBrVmVyc2lvbi50b1N0cmluZygpO1xuICB9XG5cbiAgYXN5bmMgZ2V0SW5zdGFsbGVkUGFja2FnZVZlcnNpb24gKHBrZykge1xuICAgIGxldCBzdGRvdXQgPSAgYXdhaXQgdGhpcy5hZGIuc2hlbGwoWydkdW1wc3lzJywgJ3BhY2thZ2UnLCBwa2ddKTtcbiAgICBsZXQgcGtnVmVyc2lvbiA9IG5ldyBSZWdFeHAoL3ZlcnNpb25OYW1lPShbXlxcc1xcc10rKS9nKS5leGVjKHN0ZG91dCk7XG4gICAgaWYgKHBrZ1ZlcnNpb24gJiYgcGtnVmVyc2lvbi5sZW5ndGggPj0gMikge1xuICAgICAgcGtnVmVyc2lvbiA9IHBrZ1ZlcnNpb25bMV07XG4gICAgfSBlbHNlIHtcbiAgICAgIHBrZ1ZlcnNpb24gPSBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gcGtnVmVyc2lvbi50b1N0cmluZygpO1xuICB9XG5cbiAgYXN5bmMgY2hlY2tBbmRTaWduQ2VydCAoYXBrLCBhcGtQYWNrYWdlKSB7XG4gICAgbGV0IHNpZ25lZCA9IGF3YWl0IHRoaXMuYWRiLmNoZWNrQXBrQ2VydChhcGssIGFwa1BhY2thZ2UpO1xuICAgIGlmICghc2lnbmVkKSB7XG4gICAgICBhd2FpdCB0aGlzLmFkYi5zaWduKGFwayk7XG4gICAgfVxuICAgIHJldHVybiAhc2lnbmVkO1xuICB9XG5cbiAgYXN5bmMgc3RhcnRTZXNzaW9uIChjYXBzKSB7XG4gICAgbGV0IGNtZCA9IFsnYW0nLCAnaW5zdHJ1bWVudCcsICctdycsXG4gICAgICAnaW8uYXBwaXVtLnVpYXV0b21hdG9yMi5zZXJ2ZXIudGVzdC9hbmRyb2lkLnN1cHBvcnQudGVzdC5ydW5uZXIuQW5kcm9pZEpVbml0UnVubmVyJ107XG5cbiAgICAvLyBraWxsaW5nIGFueSB1aWF1dG9tYXRvciBleGlzdGluZyBwcm9jZXNzZXNcbiAgICBhd2FpdCB0aGlzLmtpbGxVaUF1dG9tYXRvck9uRGV2aWNlKCk7XG5cbiAgICBsb2dnZXIuaW5mbyhgU3RhcnRpbmcgdWlhdXRvbWF0b3IyIHNlcnZlciAke1VJMl9WRVJ9IHdpdGggY21kOiBgICtcbiAgICAgICAgYCR7Y21kfWApO1xuICAgIC8vdGhpcy5hZGIuc2hlbGwoY21kKTtcbiAgICAvL3VzaW5nIDNyZCBwYXJ0eSBtb2R1bGUgY2FsbGVkICdhZGJLaXQnIGZvciB0aW1lIGJlaW5nIGFzIHVzaW5nICdhcHBpdW0tYWRiJ1xuICAgIC8vZmFjaW5nIElsbGVnYWxTdGF0ZUV4Y2VwdGlvbjogVWlBdXRvbWF0aW9uIG5vdCBjb25uZWN0ZWQgZXhjZXB0aW9uXG4gICAgLy9odHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2FwcGl1bS11aWF1dG9tYXRvcjItZHJpdmVyL2lzc3Vlcy8xOVxuXG4gICAgaWYgKGNhcHMuZGV2aWNlVURJRCkge1xuICAgICAgdGhpcy5zdGFydFNlc3Npb25PblNwZWNpZmljRGV2aWNlVXNpbmdBZGJLaXQoY2Fwcy5kZXZpY2VVRElEKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zdGFydFNlc3Npb25Vc2luZ0FkYmtpdCgpO1xuICAgIH1cblxuICAgIGxvZ2dlci5pbmZvKCdXYWl0aW5nIGZvciBVaUF1dG9tYXRvcjIgdG8gYmUgb25saW5lLi4uJyk7XG4gICAgLy8gd2FpdCAyMHMgZm9yIFVpQXV0b21hdG9yMiB0byBiZSBvbmxpbmVcbiAgICBhd2FpdCByZXRyeUludGVydmFsKDIwLCAxMDAwLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCB0aGlzLmp3cHJveHkuY29tbWFuZCgnL3N0YXR1cycsICdHRVQnKTtcbiAgICB9KTtcbiAgICBhd2FpdCB0aGlzLmp3cHJveHkuY29tbWFuZCgnL3Nlc3Npb24nLCAnUE9TVCcsIHtkZXNpcmVkQ2FwYWJpbGl0aWVzOiBjYXBzfSk7XG4gIH1cblxuICBhc3luYyBzdGFydFNlc3Npb25PblNwZWNpZmljRGV2aWNlVXNpbmdBZGJLaXQgKGRldmljZVVESUQpIHtcbiAgICBQcm9taXNlLnRyeShmdW5jdGlvbiAoKXtcbiAgICAgIGxvZ2dlci5pbmZvKGBydW5uaW5nIGNvbW1hbmQuLi5cXG4gYWRiIC1zICR7ZGV2aWNlVURJRH0gc2hlbGwgYW0gaW5zdHJ1bWVudCAtdyBpby5hcHBpdW0udWlhdXRvbWF0b3IyLnNlcnZlci50ZXN0L2FuZHJvaWQuc3VwcG9ydC50ZXN0LnJ1bm5lci5BbmRyb2lkSlVuaXRSdW5uZXIuLi4gYCk7XG4gICAgICBjbGllbnQuc2hlbGwoZGV2aWNlVURJRCwgXCJhbSBpbnN0cnVtZW50IC13IGlvLmFwcGl1bS51aWF1dG9tYXRvcjIuc2VydmVyLnRlc3QvYW5kcm9pZC5zdXBwb3J0LnRlc3QucnVubmVyLkFuZHJvaWRKVW5pdFJ1bm5lclwiKTtcbiAgICB9KVxuICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdTb21ldGhpbmcgd2VudCB3cm9uZyB3aGlsZSBleGVjdXRpbmcgaW5zdHJ1bWVudCB0ZXN0OicsIGVyci5zdGFjayk7XG4gICAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0U2Vzc2lvblVzaW5nQWRia2l0ICgpIHtcbiAgICBjbGllbnQubGlzdERldmljZXMoKVxuICAgICAgICAudGhlbihmdW5jdGlvbiAoZGV2aWNlcykge1xuICAgICAgICAgIFByb21pc2UubWFwKGRldmljZXMsIGZ1bmN0aW9uIChkZXZpY2UpIHtcbiAgICAgICAgICAgIGxvZ2dlci5pbmZvKFwicnVubmluZyBjb21tYW5kLi4uXFxuIGFkYiBzaGVsbCBhbSBpbnN0cnVtZW50IC13IGlvLmFwcGl1bS51aWF1dG9tYXRvcjIuc2VydmVyLnRlc3QvYW5kcm9pZC5zdXBwb3J0LnRlc3QucnVubmVyLkFuZHJvaWRKVW5pdFJ1bm5lci4uLiBcIik7XG4gICAgICAgICAgICBjbGllbnQuc2hlbGwoZGV2aWNlLmlkLCBcImFtIGluc3RydW1lbnQgLXcgaW8uYXBwaXVtLnVpYXV0b21hdG9yMi5zZXJ2ZXIudGVzdC9hbmRyb2lkLnN1cHBvcnQudGVzdC5ydW5uZXIuQW5kcm9pZEpVbml0UnVubmVyXCIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgIGxvZ2dlci5lcnJvcignU29tZXRoaW5nIHdlbnQgd3Jvbmcgd2hpbGUgZXhlY3V0aW5nIGluc3RydW1lbnQgdGVzdDonLCBlcnIuc3RhY2spO1xuICAgICAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZVNlc3Npb24gKCkge1xuICAgIGxvZ2dlci5kZWJ1ZygnRGVsZXRpbmcgVWlBdXRvbWF0b3IyIHNlcnZlciBzZXNzaW9uJyk7XG4gICAgLy8gcmVseSBvbiBqd3Byb3h5J3MgaW50ZWxsaWdlbmNlIHRvIGtub3cgd2hhdCB3ZSdyZSB0YWxraW5nIGFib3V0IGFuZFxuICAgIC8vIGRlbGV0ZSB0aGUgY3VycmVudCBzZXNzaW9uXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuandwcm94eS5jb21tYW5kKCcvJywgJ0RFTEVURScpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nZ2VyLndhcm4oYERpZCBub3QgZ2V0IGNvbmZpcm1hdGlvbiBVaUF1dG9tYXRvcjIgZGVsZXRlU2Vzc2lvbiB3b3JrZWQ7IGAgK1xuICAgICAgICAgIGBFcnJvciB3YXM6ICR7ZXJyfWApO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGtpbGxVaUF1dG9tYXRvck9uRGV2aWNlICgpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5hZGIuZm9yY2VTdG9wKCdpby5hcHBpdW0udWlhdXRvbWF0b3IyLnNlcnZlcicpO1xuICAgIH0gY2F0Y2ggKGlnbm9yZSkge1xuICAgICAgbG9nZ2VyLmluZm8oXCJVbmFibGUgdG8ga2lsbCB0aGUgaW8uYXBwaXVtLnVpYXV0b21hdG9yMi5zZXJ2ZXIgcHJvY2VzcywgYXNzdW1pbmcgaXQgaXMgYWxyZWFkeSBraWxsZWRcIik7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFVpQXV0b21hdG9yMlNlcnZlcjtcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
