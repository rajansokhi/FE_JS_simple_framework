'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _ = require('../..');

var _2 = _interopRequireDefault(_);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _libHelpersJs = require('../../lib/helpers.js');

var _asyncbox = require('asyncbox');

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('apk utils', function () {
  var _this = this;

  var adb = undefined;
  var contactManagerPath = _path2['default'].resolve(_libHelpersJs.rootDir, 'test', 'fixtures', 'ContactManager.apk');
  var deviceTempPath = '/data/local/tmp/';
  var assertPackageAndActivity = function assertPackageAndActivity() {
    var _ref, appPackage, appActivity;

    return _regeneratorRuntime.async(function assertPackageAndActivity$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.getFocusedPackageAndActivity());

        case 2:
          _ref = context$2$0.sent;
          appPackage = _ref.appPackage;
          appActivity = _ref.appActivity;

          appPackage.should.equal('com.example.android.contactmanager');
          appActivity.should.equal('.ContactManager');

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  };
  this.timeout(60000);
  before(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_2['default'].createADB());

        case 2:
          adb = context$2$0.sent;

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should be able to check status of third party app', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.isAppInstalled('com.android.phone'));

        case 2:
          context$2$0.sent.should.be['true'];

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should be able to install/remove app and detect its status', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.isAppInstalled('foo'));

        case 2:
          context$2$0.sent.should.be['false'];
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(adb.install(contactManagerPath));

        case 5:
          context$2$0.next = 7;
          return _regeneratorRuntime.awrap(adb.isAppInstalled('com.example.android.contactmanager'));

        case 7:
          context$2$0.sent.should.be['true'];
          context$2$0.next = 10;
          return _regeneratorRuntime.awrap(adb.uninstallApk('com.example.android.contactmanager'));

        case 10:
          context$2$0.sent.should.be['true'];
          context$2$0.next = 13;
          return _regeneratorRuntime.awrap(adb.isAppInstalled('com.example.android.contactmanager'));

        case 13:
          context$2$0.sent.should.be['false'];
          context$2$0.next = 16;
          return _regeneratorRuntime.awrap(adb.uninstallApk('com.example.android.contactmanager'));

        case 16:
          context$2$0.sent.should.be['false'];
          context$2$0.next = 19;
          return _regeneratorRuntime.awrap(adb.rimraf(deviceTempPath + 'ContactManager.apk'));

        case 19:
          context$2$0.next = 21;
          return _regeneratorRuntime.awrap(adb.push(contactManagerPath, deviceTempPath));

        case 21:
          context$2$0.next = 23;
          return _regeneratorRuntime.awrap(adb.installFromDevicePath(deviceTempPath + 'ContactManager.apk'));

        case 23:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  describe('startUri', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      var _this3 = this;

      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          it('should be able to start a uri', function callee$2$0() {
            var res;
            return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
              var _this2 = this;

              while (1) switch (context$3$0.prev = context$3$0.next) {
                case 0:
                  context$3$0.next = 2;
                  return _regeneratorRuntime.awrap(adb.goToHome());

                case 2:
                  context$3$0.next = 4;
                  return _regeneratorRuntime.awrap(adb.getFocusedPackageAndActivity());

                case 4:
                  res = context$3$0.sent;

                  res.appPackage.should.not.equal('com.android.contacts');
                  context$3$0.next = 8;
                  return _regeneratorRuntime.awrap(adb.install(contactManagerPath));

                case 8:
                  context$3$0.next = 10;
                  return _regeneratorRuntime.awrap(adb.startUri('content://contacts/people', 'com.android.contacts'));

                case 10:
                  context$3$0.next = 12;
                  return _regeneratorRuntime.awrap((0, _asyncbox.retryInterval)(10, 500, function callee$3$0() {
                    var focusRe1, focusRe2;
                    return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
                      while (1) switch (context$4$0.prev = context$4$0.next) {
                        case 0:
                          context$4$0.next = 2;
                          return _regeneratorRuntime.awrap(adb.shell(['dumpsys', 'window', 'windows']));

                        case 2:
                          res = context$4$0.sent;
                          focusRe1 = '(mCurrentFocus.+\\.PeopleActivity)';
                          focusRe2 = '(mFocusedApp.+\\.PeopleActivity)';

                          res.should.match(new RegExp(focusRe1 + '|' + focusRe2));

                        case 6:
                        case 'end':
                          return context$4$0.stop();
                      }
                    }, null, _this2);
                  }));

                case 12:
                  context$3$0.next = 14;
                  return _regeneratorRuntime.awrap(adb.goToHome());

                case 14:
                case 'end':
                  return context$3$0.stop();
              }
            }, null, _this3);
          });

        case 1:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  describe('startApp', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      var _this4 = this;

      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          it('should be able to start', function callee$2$0() {
            return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
              while (1) switch (context$3$0.prev = context$3$0.next) {
                case 0:
                  context$3$0.next = 2;
                  return _regeneratorRuntime.awrap(adb.install(contactManagerPath));

                case 2:
                  context$3$0.next = 4;
                  return _regeneratorRuntime.awrap(adb.startApp({ pkg: 'com.example.android.contactmanager',
                    activity: 'ContactManager' }));

                case 4:
                  context$3$0.next = 6;
                  return _regeneratorRuntime.awrap(assertPackageAndActivity());

                case 6:
                case 'end':
                  return context$3$0.stop();
              }
            }, null, _this4);
          });
          it('should throw error for wrong activity', function callee$2$0() {
            return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
              while (1) switch (context$3$0.prev = context$3$0.next) {
                case 0:
                  context$3$0.next = 2;
                  return _regeneratorRuntime.awrap(adb.install(contactManagerPath));

                case 2:
                  context$3$0.next = 4;
                  return _regeneratorRuntime.awrap(adb.startApp({ pkg: 'com.example.android.contactmanager',
                    activity: 'ContactManage' }).should.eventually.be.rejectedWith('Activity'));

                case 4:
                case 'end':
                  return context$3$0.stop();
              }
            }, null, _this4);
          });
          it('should throw error for wrong wait activity', function callee$2$0() {
            return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
              while (1) switch (context$3$0.prev = context$3$0.next) {
                case 0:
                  context$3$0.next = 2;
                  return _regeneratorRuntime.awrap(adb.install(contactManagerPath));

                case 2:
                  context$3$0.next = 4;
                  return _regeneratorRuntime.awrap(adb.startApp({ pkg: 'com.example.android.contactmanager',
                    activity: 'ContactManager',
                    waitActivity: 'foo',
                    waitDuration: 1000 }).should.eventually.be.rejectedWith('foo'));

                case 4:
                case 'end':
                  return context$3$0.stop();
              }
            }, null, _this4);
          });
          it('should start activity with wait activity', function callee$2$0() {
            return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
              while (1) switch (context$3$0.prev = context$3$0.next) {
                case 0:
                  context$3$0.next = 2;
                  return _regeneratorRuntime.awrap(adb.install(contactManagerPath));

                case 2:
                  context$3$0.next = 4;
                  return _regeneratorRuntime.awrap(adb.startApp({ pkg: 'com.example.android.contactmanager',
                    activity: 'ContactManager',
                    waitActivity: '.ContactManager' }));

                case 4:
                  context$3$0.next = 6;
                  return _regeneratorRuntime.awrap(assertPackageAndActivity());

                case 6:
                case 'end':
                  return context$3$0.stop();
              }
            }, null, _this4);
          });
          it('should start activity when wait activity is a wildcard', function callee$2$0() {
            return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
              while (1) switch (context$3$0.prev = context$3$0.next) {
                case 0:
                  context$3$0.next = 2;
                  return _regeneratorRuntime.awrap(adb.install(contactManagerPath));

                case 2:
                  context$3$0.next = 4;
                  return _regeneratorRuntime.awrap(adb.startApp({ pkg: 'com.example.android.contactmanager',
                    activity: 'ContactManager',
                    waitActivity: '*' }));

                case 4:
                  context$3$0.next = 6;
                  return _regeneratorRuntime.awrap(assertPackageAndActivity());

                case 6:
                case 'end':
                  return context$3$0.stop();
              }
            }, null, _this4);
          });
          it('should start activity when wait activity contains a wildcard', function callee$2$0() {
            return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
              while (1) switch (context$3$0.prev = context$3$0.next) {
                case 0:
                  context$3$0.next = 2;
                  return _regeneratorRuntime.awrap(adb.install(contactManagerPath));

                case 2:
                  context$3$0.next = 4;
                  return _regeneratorRuntime.awrap(adb.startApp({ pkg: 'com.example.android.contactmanager',
                    activity: 'ContactManager',
                    waitActivity: '*.ContactManager' }));

                case 4:
                  context$3$0.next = 6;
                  return _regeneratorRuntime.awrap(assertPackageAndActivity());

                case 6:
                case 'end':
                  return context$3$0.stop();
              }
            }, null, _this4);
          });
          it('should throw error for wrong activity when wait activity contains a wildcard', function callee$2$0() {
            return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
              while (1) switch (context$3$0.prev = context$3$0.next) {
                case 0:
                  context$3$0.next = 2;
                  return _regeneratorRuntime.awrap(adb.install(contactManagerPath));

                case 2:
                  context$3$0.next = 4;
                  return _regeneratorRuntime.awrap(adb.startApp({ pkg: 'com.example.android.contactmanager',
                    activity: 'SuperManager',
                    waitActivity: '*.ContactManager' }).should.eventually.be.rejectedWith('Activity'));

                case 4:
                case 'end':
                  return context$3$0.stop();
              }
            }, null, _this4);
          });
          it('should throw error for wrong wait activity which contains wildcard', function callee$2$0() {
            return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
              while (1) switch (context$3$0.prev = context$3$0.next) {
                case 0:
                  context$3$0.next = 2;
                  return _regeneratorRuntime.awrap(adb.install(contactManagerPath));

                case 2:
                  context$3$0.next = 4;
                  return _regeneratorRuntime.awrap(adb.startApp({ pkg: 'com.example.android.contactmanager',
                    activity: 'ContactManager',
                    waitActivity: '*.SuperManager' }).should.eventually.be.rejectedWith('SuperManager'));

                case 4:
                case 'end':
                  return context$3$0.stop();
              }
            }, null, _this4);
          });

        case 8:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('getFocusedPackageAndActivity should be able get package and activity', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.install(contactManagerPath));

        case 2:
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap(adb.startApp({ pkg: 'com.example.android.contactmanager',
            activity: 'ContactManager' }));

        case 4:
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(assertPackageAndActivity());

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('extractStringsFromApk should get strings for default language', function callee$1$0() {
    var _ref2, apkStrings;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.extractStringsFromApk(contactManagerPath, null, '/tmp'));

        case 2:
          _ref2 = context$2$0.sent;
          apkStrings = _ref2.apkStrings;

          apkStrings.save.should.equal('Save');

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
});

// depending on apilevel, app might show up as active in one of these
// two dumpsys output formats
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZnVuY3Rpb25hbC9hcGstdXRpbHMtZTJlLXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztvQkFBaUIsTUFBTTs7Ozs4QkFDSSxrQkFBa0I7Ozs7Z0JBQzdCLE9BQU87Ozs7b0JBQ04sTUFBTTs7Ozs0QkFDQyxzQkFBc0I7O3dCQUNoQixVQUFVOztBQUV4QyxrQkFBSyxNQUFNLEVBQUUsQ0FBQztBQUNkLGtCQUFLLEdBQUcsNkJBQWdCLENBQUM7O0FBRXpCLFFBQVEsQ0FBQyxXQUFXLEVBQUUsWUFBWTs7O0FBQ2hDLE1BQUksR0FBRyxZQUFBLENBQUM7QUFDUixNQUFNLGtCQUFrQixHQUFHLGtCQUFLLE9BQU8sd0JBQVUsTUFBTSxFQUNmLFVBQVUsRUFBRSxvQkFBb0IsQ0FBQyxDQUFDO0FBQzFFLE1BQU0sY0FBYyxHQUFHLGtCQUFrQixDQUFDO0FBQzFDLE1BQU0sd0JBQXdCLEdBQUcsU0FBM0Isd0JBQXdCO2NBQ3ZCLFVBQVUsRUFBRSxXQUFXOzs7Ozs7MkNBQVUsR0FBRyxDQUFDLDRCQUE0QixFQUFFOzs7O0FBQW5FLG9CQUFVLFFBQVYsVUFBVTtBQUFFLHFCQUFXLFFBQVgsV0FBVzs7QUFDNUIsb0JBQVUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLG9DQUFvQyxDQUFDLENBQUM7QUFDOUQscUJBQVcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLENBQUM7Ozs7Ozs7R0FDN0MsQ0FBQztBQUNGLE1BQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDcEIsUUFBTSxDQUFDOzs7OzsyQ0FDTyxjQUFJLFNBQVMsRUFBRTs7O0FBQTNCLGFBQUc7Ozs7Ozs7R0FDSixDQUFDLENBQUM7QUFDSCxJQUFFLENBQUMsbURBQW1ELEVBQUU7Ozs7OzJDQUMvQyxHQUFHLENBQUMsY0FBYyxDQUFDLG1CQUFtQixDQUFDOzs7MkJBQUUsTUFBTSxDQUFDLEVBQUU7Ozs7Ozs7R0FDMUQsQ0FBQyxDQUFDO0FBQ0gsSUFBRSxDQUFDLDREQUE0RCxFQUFFOzs7OzsyQ0FDeEQsR0FBRyxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUM7OzsyQkFBRSxNQUFNLENBQUMsRUFBRTs7MkNBQ3JDLEdBQUcsQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUM7Ozs7MkNBQzlCLEdBQUcsQ0FBQyxjQUFjLENBQUMsb0NBQW9DLENBQUM7OzsyQkFBRSxNQUFNLENBQUMsRUFBRTs7MkNBQ25FLEdBQUcsQ0FBQyxZQUFZLENBQUMsb0NBQW9DLENBQUM7OzsyQkFBRSxNQUFNLENBQUMsRUFBRTs7MkNBQ2pFLEdBQUcsQ0FBQyxjQUFjLENBQUMsb0NBQW9DLENBQUM7OzsyQkFBRSxNQUFNLENBQUMsRUFBRTs7MkNBQ25FLEdBQUcsQ0FBQyxZQUFZLENBQUMsb0NBQW9DLENBQUM7OzsyQkFBRSxNQUFNLENBQUMsRUFBRTs7MkNBQ2xFLEdBQUcsQ0FBQyxNQUFNLENBQUMsY0FBYyxHQUFHLG9CQUFvQixDQUFDOzs7OzJDQUNqRCxHQUFHLENBQUMsSUFBSSxDQUFDLGtCQUFrQixFQUFFLGNBQWMsQ0FBQzs7OzsyQ0FDNUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDLGNBQWMsR0FBRyxvQkFBb0IsQ0FBQzs7Ozs7OztHQUN2RSxDQUFDLENBQUM7QUFDSCxVQUFRLENBQUMsVUFBVSxFQUFFOzs7Ozs7QUFDbkIsWUFBRSxDQUFDLCtCQUErQixFQUFFO2dCQUU5QixHQUFHOzs7Ozs7O21EQURELEdBQUcsQ0FBQyxRQUFRLEVBQUU7Ozs7bURBQ0osR0FBRyxDQUFDLDRCQUE0QixFQUFFOzs7QUFBOUMscUJBQUc7O0FBQ1AscUJBQUcsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsc0JBQXNCLENBQUMsQ0FBQzs7bURBQ2xELEdBQUcsQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUM7Ozs7bURBQy9CLEdBQUcsQ0FBQyxRQUFRLENBQUMsMkJBQTJCLEVBQUUsc0JBQXNCLENBQUM7Ozs7bURBQ2pFLDZCQUFjLEVBQUUsRUFBRSxHQUFHLEVBQUU7d0JBSXZCLFFBQVEsRUFDUixRQUFROzs7OzsyREFKQSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsU0FBUyxFQUFFLFFBQVEsRUFBRSxTQUFTLENBQUMsQ0FBQzs7O0FBQXZELDZCQUFHO0FBR0Msa0NBQVEsR0FBRyxvQ0FBb0M7QUFDL0Msa0NBQVEsR0FBRyxrQ0FBa0M7O0FBQ2pELDZCQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLE1BQU0sQ0FBSSxRQUFRLFNBQUksUUFBUSxDQUFHLENBQUMsQ0FBQzs7Ozs7OzttQkFDekQsQ0FBQzs7OzttREFDSSxHQUFHLENBQUMsUUFBUSxFQUFFOzs7Ozs7O1dBQ3JCLENBQUMsQ0FBQzs7Ozs7OztHQUNKLENBQUMsQ0FBQztBQUNILFVBQVEsQ0FBQyxVQUFVLEVBQUU7Ozs7OztBQUNuQixZQUFFLENBQUMseUJBQXlCLEVBQUU7Ozs7O21EQUN0QixHQUFHLENBQUMsT0FBTyxDQUFDLGtCQUFrQixDQUFDOzs7O21EQUMvQixHQUFHLENBQUMsUUFBUSxDQUFDLEVBQUMsR0FBRyxFQUFFLG9DQUFvQztBQUN6Qyw0QkFBUSxFQUFFLGdCQUFnQixFQUFDLENBQUM7Ozs7bURBQzFDLHdCQUF3QixFQUFFOzs7Ozs7O1dBRWpDLENBQUMsQ0FBQztBQUNILFlBQUUsQ0FBQyx1Q0FBdUMsRUFBRTs7Ozs7bURBQ3BDLEdBQUcsQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUM7Ozs7bURBQy9CLEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBQyxHQUFHLEVBQUUsb0NBQW9DO0FBQ3pDLDRCQUFRLEVBQUUsZUFBZSxFQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUNqQixFQUFFLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQzs7Ozs7OztXQUM1RSxDQUFDLENBQUM7QUFDSCxZQUFFLENBQUMsNENBQTRDLEVBQUU7Ozs7O21EQUN6QyxHQUFHLENBQUMsT0FBTyxDQUFDLGtCQUFrQixDQUFDOzs7O21EQUMvQixHQUFHLENBQUMsUUFBUSxDQUFDLEVBQUMsR0FBRyxFQUFFLG9DQUFvQztBQUN6Qyw0QkFBUSxFQUFFLGdCQUFnQjtBQUMxQixnQ0FBWSxFQUFFLEtBQUs7QUFDbkIsZ0NBQVksRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQ2pCLEVBQUUsQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDOzs7Ozs7O1dBQ2hFLENBQUMsQ0FBQztBQUNILFlBQUUsQ0FBQywwQ0FBMEMsRUFBRTs7Ozs7bURBQ3ZDLEdBQUcsQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUM7Ozs7bURBQy9CLEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBQyxHQUFHLEVBQUUsb0NBQW9DO0FBQ3pDLDRCQUFRLEVBQUUsZ0JBQWdCO0FBQzFCLGdDQUFZLEVBQUUsaUJBQWlCLEVBQUMsQ0FBQzs7OzttREFDL0Msd0JBQXdCLEVBQUU7Ozs7Ozs7V0FDakMsQ0FBQyxDQUFDO0FBQ0gsWUFBRSxDQUFDLHdEQUF3RCxFQUFFOzs7OzttREFDckQsR0FBRyxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQzs7OzttREFDL0IsR0FBRyxDQUFDLFFBQVEsQ0FBQyxFQUFDLEdBQUcsRUFBRSxvQ0FBb0M7QUFDekMsNEJBQVEsRUFBRSxnQkFBZ0I7QUFDMUIsZ0NBQVksRUFBRSxHQUFHLEVBQUMsQ0FBQzs7OzttREFDakMsd0JBQXdCLEVBQUU7Ozs7Ozs7V0FDakMsQ0FBQyxDQUFDO0FBQ0gsWUFBRSxDQUFDLDhEQUE4RCxFQUFFOzs7OzttREFDM0QsR0FBRyxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQzs7OzttREFDL0IsR0FBRyxDQUFDLFFBQVEsQ0FBQyxFQUFDLEdBQUcsRUFBRSxvQ0FBb0M7QUFDekMsNEJBQVEsRUFBRSxnQkFBZ0I7QUFDMUIsZ0NBQVksRUFBRSxrQkFBa0IsRUFBQyxDQUFDOzs7O21EQUNoRCx3QkFBd0IsRUFBRTs7Ozs7OztXQUNqQyxDQUFDLENBQUM7QUFDSCxZQUFFLENBQUMsOEVBQThFLEVBQUU7Ozs7O21EQUMzRSxHQUFHLENBQUMsT0FBTyxDQUFDLGtCQUFrQixDQUFDOzs7O21EQUMvQixHQUFHLENBQUMsUUFBUSxDQUFDLEVBQUMsR0FBRyxFQUFFLG9DQUFvQztBQUN6Qyw0QkFBUSxFQUFFLGNBQWM7QUFDeEIsZ0NBQVksRUFBRSxrQkFBa0IsRUFBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FDakIsRUFBRSxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUM7Ozs7Ozs7V0FDbkYsQ0FBQyxDQUFDO0FBQ0gsWUFBRSxDQUFDLG9FQUFvRSxFQUFFOzs7OzttREFDakUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQzs7OzttREFDL0IsR0FBRyxDQUFDLFFBQVEsQ0FBQyxFQUFDLEdBQUcsRUFBRSxvQ0FBb0M7QUFDekMsNEJBQVEsRUFBRSxnQkFBZ0I7QUFDMUIsZ0NBQVksRUFBRSxnQkFBZ0IsRUFBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FDakIsRUFBRSxDQUFDLFlBQVksQ0FBQyxjQUFjLENBQUM7Ozs7Ozs7V0FDckYsQ0FBQyxDQUFDOzs7Ozs7O0dBRUosQ0FBQyxDQUFDO0FBQ0gsSUFBRSxDQUFDLHNFQUFzRSxFQUFFOzs7OzsyQ0FDbkUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQzs7OzsyQ0FDL0IsR0FBRyxDQUFDLFFBQVEsQ0FBQyxFQUFDLEdBQUcsRUFBRSxvQ0FBb0M7QUFDekMsb0JBQVEsRUFBRSxnQkFBZ0IsRUFBQyxDQUFDOzs7OzJDQUMxQyx3QkFBd0IsRUFBRTs7Ozs7OztHQUNqQyxDQUFDLENBQUM7QUFDSCxJQUFFLENBQUMsK0RBQStELEVBQUU7ZUFDN0QsVUFBVTs7Ozs7OzJDQUFVLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxrQkFBa0IsRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDOzs7O0FBQS9FLG9CQUFVLFNBQVYsVUFBVTs7QUFDZixvQkFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDOzs7Ozs7O0dBQ3RDLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L2Z1bmN0aW9uYWwvYXBrLXV0aWxzLWUyZS1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjaGFpIGZyb20gJ2NoYWknO1xuaW1wb3J0IGNoYWlBc1Byb21pc2VkIGZyb20gJ2NoYWktYXMtcHJvbWlzZWQnO1xuaW1wb3J0IEFEQiBmcm9tICcuLi8uLic7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IHJvb3REaXIgfSBmcm9tICcuLi8uLi9saWIvaGVscGVycy5qcyc7XG5pbXBvcnQgeyByZXRyeUludGVydmFsIH0gZnJvbSAnYXN5bmNib3gnO1xuXG5jaGFpLnNob3VsZCgpO1xuY2hhaS51c2UoY2hhaUFzUHJvbWlzZWQpO1xuXG5kZXNjcmliZSgnYXBrIHV0aWxzJywgZnVuY3Rpb24gKCkge1xuICBsZXQgYWRiO1xuICBjb25zdCBjb250YWN0TWFuYWdlclBhdGggPSBwYXRoLnJlc29sdmUocm9vdERpciwgJ3Rlc3QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ZpeHR1cmVzJywgJ0NvbnRhY3RNYW5hZ2VyLmFwaycpO1xuICBjb25zdCBkZXZpY2VUZW1wUGF0aCA9ICcvZGF0YS9sb2NhbC90bXAvJztcbiAgY29uc3QgYXNzZXJ0UGFja2FnZUFuZEFjdGl2aXR5ID0gYXN5bmMgKCkgPT4ge1xuICAgIGxldCB7YXBwUGFja2FnZSwgYXBwQWN0aXZpdHl9ID0gYXdhaXQgYWRiLmdldEZvY3VzZWRQYWNrYWdlQW5kQWN0aXZpdHkoKTtcbiAgICBhcHBQYWNrYWdlLnNob3VsZC5lcXVhbCgnY29tLmV4YW1wbGUuYW5kcm9pZC5jb250YWN0bWFuYWdlcicpO1xuICAgIGFwcEFjdGl2aXR5LnNob3VsZC5lcXVhbCgnLkNvbnRhY3RNYW5hZ2VyJyk7XG4gIH07XG4gIHRoaXMudGltZW91dCg2MDAwMCk7XG4gIGJlZm9yZShhc3luYyAoKSA9PiB7XG4gICAgYWRiID0gYXdhaXQgQURCLmNyZWF0ZUFEQigpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBiZSBhYmxlIHRvIGNoZWNrIHN0YXR1cyBvZiB0aGlyZCBwYXJ0eSBhcHAnLCBhc3luYyAoKSA9PiB7XG4gICAgKGF3YWl0IGFkYi5pc0FwcEluc3RhbGxlZCgnY29tLmFuZHJvaWQucGhvbmUnKSkuc2hvdWxkLmJlLnRydWU7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGJlIGFibGUgdG8gaW5zdGFsbC9yZW1vdmUgYXBwIGFuZCBkZXRlY3QgaXRzIHN0YXR1cycsIGFzeW5jICgpID0+IHtcbiAgICAoYXdhaXQgYWRiLmlzQXBwSW5zdGFsbGVkKCdmb28nKSkuc2hvdWxkLmJlLmZhbHNlO1xuICAgIGF3YWl0IGFkYi5pbnN0YWxsKGNvbnRhY3RNYW5hZ2VyUGF0aCk7XG4gICAgKGF3YWl0IGFkYi5pc0FwcEluc3RhbGxlZCgnY29tLmV4YW1wbGUuYW5kcm9pZC5jb250YWN0bWFuYWdlcicpKS5zaG91bGQuYmUudHJ1ZTtcbiAgICAoYXdhaXQgYWRiLnVuaW5zdGFsbEFwaygnY29tLmV4YW1wbGUuYW5kcm9pZC5jb250YWN0bWFuYWdlcicpKS5zaG91bGQuYmUudHJ1ZTtcbiAgICAoYXdhaXQgYWRiLmlzQXBwSW5zdGFsbGVkKCdjb20uZXhhbXBsZS5hbmRyb2lkLmNvbnRhY3RtYW5hZ2VyJykpLnNob3VsZC5iZS5mYWxzZTtcbiAgICAoYXdhaXQgYWRiLnVuaW5zdGFsbEFwaygnY29tLmV4YW1wbGUuYW5kcm9pZC5jb250YWN0bWFuYWdlcicpKS5zaG91bGQuYmUuZmFsc2U7XG4gICAgYXdhaXQgYWRiLnJpbXJhZihkZXZpY2VUZW1wUGF0aCArICdDb250YWN0TWFuYWdlci5hcGsnKTtcbiAgICBhd2FpdCBhZGIucHVzaChjb250YWN0TWFuYWdlclBhdGgsIGRldmljZVRlbXBQYXRoKTtcbiAgICBhd2FpdCBhZGIuaW5zdGFsbEZyb21EZXZpY2VQYXRoKGRldmljZVRlbXBQYXRoICsgJ0NvbnRhY3RNYW5hZ2VyLmFwaycpO1xuICB9KTtcbiAgZGVzY3JpYmUoJ3N0YXJ0VXJpJywgYXN5bmMgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYmUgYWJsZSB0byBzdGFydCBhIHVyaScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGFkYi5nb1RvSG9tZSgpO1xuICAgICAgbGV0IHJlcyA9IGF3YWl0IGFkYi5nZXRGb2N1c2VkUGFja2FnZUFuZEFjdGl2aXR5KCk7XG4gICAgICByZXMuYXBwUGFja2FnZS5zaG91bGQubm90LmVxdWFsKCdjb20uYW5kcm9pZC5jb250YWN0cycpO1xuICAgICAgYXdhaXQgYWRiLmluc3RhbGwoY29udGFjdE1hbmFnZXJQYXRoKTtcbiAgICAgIGF3YWl0IGFkYi5zdGFydFVyaSgnY29udGVudDovL2NvbnRhY3RzL3Blb3BsZScsICdjb20uYW5kcm9pZC5jb250YWN0cycpO1xuICAgICAgYXdhaXQgcmV0cnlJbnRlcnZhbCgxMCwgNTAwLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIHJlcyA9IGF3YWl0IGFkYi5zaGVsbChbJ2R1bXBzeXMnLCAnd2luZG93JywgJ3dpbmRvd3MnXSk7XG4gICAgICAgIC8vIGRlcGVuZGluZyBvbiBhcGlsZXZlbCwgYXBwIG1pZ2h0IHNob3cgdXAgYXMgYWN0aXZlIGluIG9uZSBvZiB0aGVzZVxuICAgICAgICAvLyB0d28gZHVtcHN5cyBvdXRwdXQgZm9ybWF0c1xuICAgICAgICBsZXQgZm9jdXNSZTEgPSAnKG1DdXJyZW50Rm9jdXMuK1xcXFwuUGVvcGxlQWN0aXZpdHkpJztcbiAgICAgICAgbGV0IGZvY3VzUmUyID0gJyhtRm9jdXNlZEFwcC4rXFxcXC5QZW9wbGVBY3Rpdml0eSknO1xuICAgICAgICByZXMuc2hvdWxkLm1hdGNoKG5ldyBSZWdFeHAoYCR7Zm9jdXNSZTF9fCR7Zm9jdXNSZTJ9YCkpO1xuICAgICAgfSk7XG4gICAgICBhd2FpdCBhZGIuZ29Ub0hvbWUoKTtcbiAgICB9KTtcbiAgfSk7XG4gIGRlc2NyaWJlKCdzdGFydEFwcCcsIGFzeW5jICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGJlIGFibGUgdG8gc3RhcnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBhZGIuaW5zdGFsbChjb250YWN0TWFuYWdlclBhdGgpO1xuICAgICAgYXdhaXQgYWRiLnN0YXJ0QXBwKHtwa2c6ICdjb20uZXhhbXBsZS5hbmRyb2lkLmNvbnRhY3RtYW5hZ2VyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHk6ICdDb250YWN0TWFuYWdlcid9KTtcbiAgICAgIGF3YWl0IGFzc2VydFBhY2thZ2VBbmRBY3Rpdml0eSgpO1xuXG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBmb3Igd3JvbmcgYWN0aXZpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBhZGIuaW5zdGFsbChjb250YWN0TWFuYWdlclBhdGgpO1xuICAgICAgYXdhaXQgYWRiLnN0YXJ0QXBwKHtwa2c6ICdjb20uZXhhbXBsZS5hbmRyb2lkLmNvbnRhY3RtYW5hZ2VyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHk6ICdDb250YWN0TWFuYWdlJ30pLnNob3VsZC5ldmVudHVhbGx5XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5iZS5yZWplY3RlZFdpdGgoJ0FjdGl2aXR5Jyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBmb3Igd3Jvbmcgd2FpdCBhY3Rpdml0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGFkYi5pbnN0YWxsKGNvbnRhY3RNYW5hZ2VyUGF0aCk7XG4gICAgICBhd2FpdCBhZGIuc3RhcnRBcHAoe3BrZzogJ2NvbS5leGFtcGxlLmFuZHJvaWQuY29udGFjdG1hbmFnZXInLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eTogJ0NvbnRhY3RNYW5hZ2VyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdEFjdGl2aXR5OiAnZm9vJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdER1cmF0aW9uOiAxMDAwfSkuc2hvdWxkLmV2ZW50dWFsbHlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYmUucmVqZWN0ZWRXaXRoKCdmb28nKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHN0YXJ0IGFjdGl2aXR5IHdpdGggd2FpdCBhY3Rpdml0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGFkYi5pbnN0YWxsKGNvbnRhY3RNYW5hZ2VyUGF0aCk7XG4gICAgICBhd2FpdCBhZGIuc3RhcnRBcHAoe3BrZzogJ2NvbS5leGFtcGxlLmFuZHJvaWQuY29udGFjdG1hbmFnZXInLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eTogJ0NvbnRhY3RNYW5hZ2VyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdEFjdGl2aXR5OiAnLkNvbnRhY3RNYW5hZ2VyJ30pO1xuICAgICAgYXdhaXQgYXNzZXJ0UGFja2FnZUFuZEFjdGl2aXR5KCk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBzdGFydCBhY3Rpdml0eSB3aGVuIHdhaXQgYWN0aXZpdHkgaXMgYSB3aWxkY2FyZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGFkYi5pbnN0YWxsKGNvbnRhY3RNYW5hZ2VyUGF0aCk7XG4gICAgICBhd2FpdCBhZGIuc3RhcnRBcHAoe3BrZzogJ2NvbS5leGFtcGxlLmFuZHJvaWQuY29udGFjdG1hbmFnZXInLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eTogJ0NvbnRhY3RNYW5hZ2VyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdEFjdGl2aXR5OiAnKid9KTtcbiAgICAgIGF3YWl0IGFzc2VydFBhY2thZ2VBbmRBY3Rpdml0eSgpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgc3RhcnQgYWN0aXZpdHkgd2hlbiB3YWl0IGFjdGl2aXR5IGNvbnRhaW5zIGEgd2lsZGNhcmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBhZGIuaW5zdGFsbChjb250YWN0TWFuYWdlclBhdGgpO1xuICAgICAgYXdhaXQgYWRiLnN0YXJ0QXBwKHtwa2c6ICdjb20uZXhhbXBsZS5hbmRyb2lkLmNvbnRhY3RtYW5hZ2VyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHk6ICdDb250YWN0TWFuYWdlcicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXRBY3Rpdml0eTogJyouQ29udGFjdE1hbmFnZXInfSk7XG4gICAgICBhd2FpdCBhc3NlcnRQYWNrYWdlQW5kQWN0aXZpdHkoKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGZvciB3cm9uZyBhY3Rpdml0eSB3aGVuIHdhaXQgYWN0aXZpdHkgY29udGFpbnMgYSB3aWxkY2FyZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGFkYi5pbnN0YWxsKGNvbnRhY3RNYW5hZ2VyUGF0aCk7XG4gICAgICBhd2FpdCBhZGIuc3RhcnRBcHAoe3BrZzogJ2NvbS5leGFtcGxlLmFuZHJvaWQuY29udGFjdG1hbmFnZXInLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eTogJ1N1cGVyTWFuYWdlcicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXRBY3Rpdml0eTogJyouQ29udGFjdE1hbmFnZXInfSkuc2hvdWxkLmV2ZW50dWFsbHlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5iZS5yZWplY3RlZFdpdGgoJ0FjdGl2aXR5Jyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBmb3Igd3Jvbmcgd2FpdCBhY3Rpdml0eSB3aGljaCBjb250YWlucyB3aWxkY2FyZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGFkYi5pbnN0YWxsKGNvbnRhY3RNYW5hZ2VyUGF0aCk7XG4gICAgICBhd2FpdCBhZGIuc3RhcnRBcHAoe3BrZzogJ2NvbS5leGFtcGxlLmFuZHJvaWQuY29udGFjdG1hbmFnZXInLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eTogJ0NvbnRhY3RNYW5hZ2VyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdEFjdGl2aXR5OiAnKi5TdXBlck1hbmFnZXInfSkuc2hvdWxkLmV2ZW50dWFsbHlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYmUucmVqZWN0ZWRXaXRoKCdTdXBlck1hbmFnZXInKTtcbiAgICB9KTtcblxuICB9KTtcbiAgaXQoJ2dldEZvY3VzZWRQYWNrYWdlQW5kQWN0aXZpdHkgc2hvdWxkIGJlIGFibGUgZ2V0IHBhY2thZ2UgYW5kIGFjdGl2aXR5JywgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGFkYi5pbnN0YWxsKGNvbnRhY3RNYW5hZ2VyUGF0aCk7XG4gICAgYXdhaXQgYWRiLnN0YXJ0QXBwKHtwa2c6ICdjb20uZXhhbXBsZS5hbmRyb2lkLmNvbnRhY3RtYW5hZ2VyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5OiAnQ29udGFjdE1hbmFnZXInfSk7XG4gICAgYXdhaXQgYXNzZXJ0UGFja2FnZUFuZEFjdGl2aXR5KCk7XG4gIH0pO1xuICBpdCgnZXh0cmFjdFN0cmluZ3NGcm9tQXBrIHNob3VsZCBnZXQgc3RyaW5ncyBmb3IgZGVmYXVsdCBsYW5ndWFnZScsIGFzeW5jICgpID0+IHtcbiAgICBsZXQge2Fwa1N0cmluZ3N9ID0gYXdhaXQgYWRiLmV4dHJhY3RTdHJpbmdzRnJvbUFwayhjb250YWN0TWFuYWdlclBhdGgsIG51bGwsICcvdG1wJyk7XG4gICAgYXBrU3RyaW5ncy5zYXZlLnNob3VsZC5lcXVhbCgnU2F2ZScpO1xuICB9KTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
