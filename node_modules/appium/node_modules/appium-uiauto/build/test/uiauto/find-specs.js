require('source-map-support').install();

/* globals $, rootPage */

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _base = require('./base');

describe('find', function () {
  var _this2 = this;

  (0, _base.globalInit)(this, { chai: true });

  describe("textfields", function () {
    var _this = this;

    var ctx = undefined;
    before(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _base.instrumentsInstanceInit)());

          case 2:
            ctx = context$3$0.sent;

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    after(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _base.killAll)(ctx));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    afterEach(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              $('#UICatalog').first().tap();
              $.delay(1000);
            }));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should not return duplicate UIATextField', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var cell = $('cell')[0];
              var id = '' + $.getId(cell);
              var res = $.getElementsByType('UIATextField', id);
              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(1);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should not return duplicate UIASecureTextField', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var cell = $('cell')[2];
              var id = '' + $.getId(cell);
              var res = $.getElementsByType('UIASecureTextField', id);
              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(1);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  describe('byUIAutomation', function () {
    var ctx = undefined;
    before(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _base.instrumentsInstanceInit)());

          case 2:
            ctx = context$3$0.sent;

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
    after(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _base.killAll)(ctx));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    afterEach(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              $('#UICatalog').first().tap();
              $.delay(1000);
            }));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should use global context by default', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var res = $.getElementsByUIAutomation('.getAllWithPredicate("type contains[c] \'textfield\'", true)');
              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length.at.least(4);
            res[0].ELEMENT.should.exist;

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should eval the raw code if it does not start with a dot', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var res = $.getElementsByUIAutomation('$.getElementByType(\'UIATableCell\').getAllWithPredicate("type contains[c] \'textfield\'", true)');
              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(1);
            res[0].ELEMENT.should.exist;

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should retrieve context from cache when ctx param is a string', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var parent = $.getElementByType('UIATableCell');
              var parentId = $.getId(parent);
              var res = $.getElementsByUIAutomation('.getAllWithPredicate("type contains[c] \'textfield\'", true)', parentId);
              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(1);
            res[0].ELEMENT.should.exist;

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should use context when ctx param is an object', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var parent = $.getElementByType('UIATableCell');
              var res = $.getElementsByUIAutomation('.getAllWithPredicate("type contains[c] \'textfield\'", true)', parent);
              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(1);
            res[0].ELEMENT.should.exist;

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should work when retrieving only one element', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var res = [],
                  parent,
                  el;
              el = $.getElementByUIAutomation('.getAllWithPredicate("type contains[c] \'textfield\'", true)');
              res.push(el);

              el = $.getElementByUIAutomation('$.getElementByType(\'UIATableCell\').getAllWithPredicate("type contains[c] \'textfield\'", true)');
              res.push(el);

              parent = $.getElementsByType('UIATableCell')[1];
              var parentId = $.getId(parent);
              el = $.getElementByUIAutomation('.getAllWithPredicate("type contains[c] \'textfield\'", true)', parentId);
              res.push(el);

              parent = $.getElementsByType('UIATableCell')[2];
              el = $.getElementByUIAutomation('.getAllWithPredicate("type contains[c] \'textfield\'", true)', parent);
              res.push(el);

              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(4);
            res[0].ELEMENT.should.exist;

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvdWlhdXRvL2ZpbmQtc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7OztvQkFHNkQsUUFBUTs7QUFFckUsUUFBUSxDQUFDLE1BQU0sRUFBRSxZQUFZOzs7QUFDM0Isd0JBQVcsSUFBSSxFQUFFLEVBQUMsSUFBSSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUM7O0FBRS9CLFVBQVEsQ0FBQyxZQUFZLEVBQUUsWUFBWTs7O0FBQ2pDLFFBQUksR0FBRyxZQUFBLENBQUM7QUFDUixVQUFNLENBQUM7Ozs7OzZDQUNPLG9DQUF5Qjs7O0FBQXJDLGVBQUc7Ozs7Ozs7S0FDSixDQUFDLENBQUM7QUFDSCxTQUFLLENBQUM7Ozs7OzZDQUNFLG1CQUFRLEdBQUcsQ0FBQzs7Ozs7OztLQUNuQixDQUFDLENBQUM7O0FBRUgsYUFBUyxDQUFDOzs7Ozs2Q0FDRixHQUFHLENBQUMsUUFBUSxDQUNoQixZQUFZO0FBQ1YsZUFBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDO0FBQzlCLGVBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDZixDQUNGOzs7Ozs7O0tBQ0YsQ0FBQyxDQUFDOztBQUVILE1BQUUsQ0FBQywwQ0FBMEMsRUFBRTtVQUN6QyxHQUFHOzs7Ozs2Q0FBUyxHQUFHLENBQUMsUUFBUSxDQUMxQixZQUFZO0FBQ1Ysc0JBQVEsQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDdEMsZUFBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNkLGtCQUFJLElBQUksR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDeEIsa0JBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzVCLGtCQUFJLEdBQUcsR0FBRyxDQUFDLENBQUMsaUJBQWlCLENBQUMsY0FBYyxFQUFFLEVB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QUE4RCxFQUM5RCxNQUFNLENBQ1AsQ0FBQztBQUNGLGlCQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDOztBQUViLHFCQUFPLEdBQUcsQ0FBQzthQUNaLENBQ0Y7OztBQTlCRyxlQUFHOztBQStCUCxlQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDMUIsZUFBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDOzs7Ozs7O0tBQzdCLENBQUMsQ0FBQztHQUVKLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L3VpYXV0by9maW5kLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gdHJhbnNwaWxlOm1vY2hhXG4vKiBnbG9iYWxzICQsIHJvb3RQYWdlICovXG5cbmltcG9ydCB7IGluc3RydW1lbnRzSW5zdGFuY2VJbml0LCBnbG9iYWxJbml0LCBraWxsQWxsIH0gZnJvbSAnLi9iYXNlJztcblxuZGVzY3JpYmUoJ2ZpbmQnLCBmdW5jdGlvbiAoKSB7XG4gIGdsb2JhbEluaXQodGhpcywge2NoYWk6IHRydWV9KTtcblxuICBkZXNjcmliZShcInRleHRmaWVsZHNcIiwgZnVuY3Rpb24gKCkge1xuICAgIGxldCBjdHg7XG4gICAgYmVmb3JlKGFzeW5jICgpID0+IHtcbiAgICAgIGN0eCA9IGF3YWl0IGluc3RydW1lbnRzSW5zdGFuY2VJbml0KCk7XG4gICAgfSk7XG4gICAgYWZ0ZXIoYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQga2lsbEFsbChjdHgpO1xuICAgIH0pO1xuXG4gICAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGN0eC5leGVjRnVuYyhcbiAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICQoJyNVSUNhdGFsb2cnKS5maXJzdCgpLnRhcCgpO1xuICAgICAgICAgICQuZGVsYXkoMTAwMCk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCByZXR1cm4gZHVwbGljYXRlIFVJQVRleHRGaWVsZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCByZXMgPSBhd2FpdCBjdHguZXhlY0Z1bmMoXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByb290UGFnZS5jbGlja01lbnVJdGVtKCdUZXh0IEZpZWxkcycpO1xuICAgICAgICAgICQuZGVsYXkoMjAwMCk7XG4gICAgICAgICAgdmFyIGNlbGwgPSAkKCdjZWxsJylbMF07XG4gICAgICAgICAgdmFyIGlkID0gJycgKyAkLmdldElkKGNlbGwpO1xuICAgICAgICAgIHZhciByZXMgPSAkLmdldEVsZW1lbnRzQnlUeXBlKCdVSUFUZXh0RmllbGQnLCBpZCk7XG4gICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHJlcy5zaG91bGQuaGF2ZS5sZW5ndGgoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCByZXR1cm4gZHVwbGljYXRlIFVJQVNlY3VyZVRleHRGaWVsZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCByZXMgPSBhd2FpdCBjdHguZXhlY0Z1bmMoXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByb290UGFnZS5jbGlja01lbnVJdGVtKCdUZXh0IEZpZWxkcycpO1xuICAgICAgICAgICQuZGVsYXkoMjAwMCk7XG4gICAgICAgICAgdmFyIGNlbGwgPSAkKCdjZWxsJylbMl07XG4gICAgICAgICAgdmFyIGlkID0gJycgKyAkLmdldElkKGNlbGwpO1xuICAgICAgICAgIHZhciByZXMgPSAkLmdldEVsZW1lbnRzQnlUeXBlKCdVSUFTZWN1cmVUZXh0RmllbGQnLCBpZCk7XG4gICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHJlcy5zaG91bGQuaGF2ZS5sZW5ndGgoMSk7XG4gICAgfSk7XG5cbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2J5VUlBdXRvbWF0aW9uJywgKCkgPT4ge1xuICAgIGxldCBjdHg7XG4gICAgYmVmb3JlKGFzeW5jICgpID0+IHtcbiAgICAgIGN0eCA9IGF3YWl0IGluc3RydW1lbnRzSW5zdGFuY2VJbml0KCk7XG4gICAgfSk7XG4gICAgYWZ0ZXIoYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQga2lsbEFsbChjdHgpO1xuICAgIH0pO1xuXG4gICAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGN0eC5leGVjRnVuYyhcbiAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICQoJyNVSUNhdGFsb2cnKS5maXJzdCgpLnRhcCgpO1xuICAgICAgICAgICQuZGVsYXkoMTAwMCk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVzZSBnbG9iYWwgY29udGV4dCBieSBkZWZhdWx0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHJlcyA9IGF3YWl0IGN0eC5leGVjRnVuYyhcbiAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJvb3RQYWdlLmNsaWNrTWVudUl0ZW0oJ1RleHQgRmllbGRzJyk7XG4gICAgICAgICAgJC5kZWxheSgyMDAwKTtcbiAgICAgICAgICB2YXIgcmVzID0gJC5nZXRFbGVtZW50c0J5VUlBdXRvbWF0aW9uKCcuZ2V0QWxsV2l0aFByZWRpY2F0ZShcInR5cGUgY29udGFpbnNbY10gXFwndGV4dGZpZWxkXFwnXCIsIHRydWUpJyk7XG4gICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHJlcy5zaG91bGQuaGF2ZS5sZW5ndGguYXQubGVhc3QoNCk7XG4gICAgICByZXNbMF0uRUxFTUVOVC5zaG91bGQuZXhpc3Q7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGV2YWwgdGhlIHJhdyBjb2RlIGlmIGl0IGRvZXMgbm90IHN0YXJ0IHdpdGggYSBkb3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgcmVzID0gYXdhaXQgY3R4LmV4ZWNGdW5jKFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcm9vdFBhZ2UuY2xpY2tNZW51SXRlbSgnVGV4dCBGaWVsZHMnKTtcbiAgICAgICAgICAkLmRlbGF5KDIwMDApO1xuICAgICAgICAgIHZhciByZXMgPSAkLmdldEVsZW1lbnRzQnlVSUF1dG9tYXRpb24oJyQuZ2V0RWxlbWVudEJ5VHlwZShcXCdVSUFUYWJsZUNlbGxcXCcpLmdldEFsbFdpdGhQcmVkaWNhdGUoXCJ0eXBlIGNvbnRhaW5zW2NdIFxcJ3RleHRmaWVsZFxcJ1wiLCB0cnVlKScpO1xuICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXMuc2hvdWxkLmhhdmUubGVuZ3RoKDEpO1xuICAgICAgcmVzWzBdLkVMRU1FTlQuc2hvdWxkLmV4aXN0O1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXRyaWV2ZSBjb250ZXh0IGZyb20gY2FjaGUgd2hlbiBjdHggcGFyYW0gaXMgYSBzdHJpbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgcmVzID0gYXdhaXQgY3R4LmV4ZWNGdW5jKFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcm9vdFBhZ2UuY2xpY2tNZW51SXRlbSgnVGV4dCBGaWVsZHMnKTtcbiAgICAgICAgICAkLmRlbGF5KDIwMDApO1xuICAgICAgICAgIHZhciBwYXJlbnQgPSAkLmdldEVsZW1lbnRCeVR5cGUoJ1VJQVRhYmxlQ2VsbCcpO1xuICAgICAgICAgIHZhciBwYXJlbnRJZCA9ICQuZ2V0SWQocGFyZW50KTtcbiAgICAgICAgICB2YXIgcmVzID0gJC5nZXRFbGVtZW50c0J5VUlBdXRvbWF0aW9uKFxuICAgICAgICAgICAgJy5nZXRBbGxXaXRoUHJlZGljYXRlKFwidHlwZSBjb250YWluc1tjXSBcXCd0ZXh0ZmllbGRcXCdcIiwgdHJ1ZSknLFxuICAgICAgICAgICAgcGFyZW50SWRcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXMuc2hvdWxkLmhhdmUubGVuZ3RoKDEpO1xuICAgICAgcmVzWzBdLkVMRU1FTlQuc2hvdWxkLmV4aXN0O1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1c2UgY29udGV4dCB3aGVuIGN0eCBwYXJhbSBpcyBhbiBvYmplY3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgcmVzID0gYXdhaXQgY3R4LmV4ZWNGdW5jKFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcm9vdFBhZ2UuY2xpY2tNZW51SXRlbSgnVGV4dCBGaWVsZHMnKTtcbiAgICAgICAgICAkLmRlbGF5KDIwMDApO1xuICAgICAgICAgIHZhciBwYXJlbnQgPSAkLmdldEVsZW1lbnRCeVR5cGUoJ1VJQVRhYmxlQ2VsbCcpO1xuICAgICAgICAgIHZhciByZXMgPSAkLmdldEVsZW1lbnRzQnlVSUF1dG9tYXRpb24oXG4gICAgICAgICAgICAnLmdldEFsbFdpdGhQcmVkaWNhdGUoXCJ0eXBlIGNvbnRhaW5zW2NdIFxcJ3RleHRmaWVsZFxcJ1wiLCB0cnVlKScsXG4gICAgICAgICAgICBwYXJlbnRcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXMuc2hvdWxkLmhhdmUubGVuZ3RoKDEpO1xuICAgICAgcmVzWzBdLkVMRU1FTlQuc2hvdWxkLmV4aXN0O1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB3b3JrIHdoZW4gcmV0cmlldmluZyBvbmx5IG9uZSBlbGVtZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHJlcyA9IGF3YWl0IGN0eC5leGVjRnVuYyhcbiAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJvb3RQYWdlLmNsaWNrTWVudUl0ZW0oJ1RleHQgRmllbGRzJyk7XG4gICAgICAgICAgJC5kZWxheSgyMDAwKTtcbiAgICAgICAgICB2YXIgcmVzID0gW10sIHBhcmVudCwgZWw7XG4gICAgICAgICAgZWwgPSAkLmdldEVsZW1lbnRCeVVJQXV0b21hdGlvbihcbiAgICAgICAgICAgICcuZ2V0QWxsV2l0aFByZWRpY2F0ZShcInR5cGUgY29udGFpbnNbY10gXFwndGV4dGZpZWxkXFwnXCIsIHRydWUpJ1xuICAgICAgICAgICk7XG4gICAgICAgICAgcmVzLnB1c2goZWwpO1xuXG4gICAgICAgICAgZWwgPSAkLmdldEVsZW1lbnRCeVVJQXV0b21hdGlvbignJC5nZXRFbGVtZW50QnlUeXBlKFxcJ1VJQVRhYmxlQ2VsbFxcJykuZ2V0QWxsV2l0aFByZWRpY2F0ZShcInR5cGUgY29udGFpbnNbY10gXFwndGV4dGZpZWxkXFwnXCIsIHRydWUpJyk7XG4gICAgICAgICAgcmVzLnB1c2goZWwpO1xuXG4gICAgICAgICAgcGFyZW50ID0gJC5nZXRFbGVtZW50c0J5VHlwZSgnVUlBVGFibGVDZWxsJylbMV07XG4gICAgICAgICAgdmFyIHBhcmVudElkID0gJC5nZXRJZChwYXJlbnQpO1xuICAgICAgICAgIGVsID0gJC5nZXRFbGVtZW50QnlVSUF1dG9tYXRpb24oXG4gICAgICAgICAgICAnLmdldEFsbFdpdGhQcmVkaWNhdGUoXCJ0eXBlIGNvbnRhaW5zW2NdIFxcJ3RleHRmaWVsZFxcJ1wiLCB0cnVlKScsXG4gICAgICAgICAgICBwYXJlbnRJZFxuICAgICAgICAgICk7XG4gICAgICAgICAgcmVzLnB1c2goZWwpO1xuXG4gICAgICAgICAgcGFyZW50ID0gJC5nZXRFbGVtZW50c0J5VHlwZSgnVUlBVGFibGVDZWxsJylbMl07XG4gICAgICAgICAgZWwgPSAkLmdldEVsZW1lbnRCeVVJQXV0b21hdGlvbihcbiAgICAgICAgICAgICcuZ2V0QWxsV2l0aFByZWRpY2F0ZShcInR5cGUgY29udGFpbnNbY10gXFwndGV4dGZpZWxkXFwnXCIsIHRydWUpJyxcbiAgICAgICAgICAgIHBhcmVudFxuICAgICAgICAgICk7XG4gICAgICAgICAgcmVzLnB1c2goZWwpO1xuXG4gICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHJlcy5zaG91bGQuaGF2ZS5sZW5ndGgoNCk7XG4gICAgICByZXNbMF0uRUxFTUVOVC5zaG91bGQuZXhpc3Q7XG4gICAgfSk7XG5cbiAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
